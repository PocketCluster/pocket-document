<!DOCTYPE html>
<html lang="en">
<head>
    <title>Encapsulating Data</title>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta charset="utf-8">
    <meta id="book-resource-type" name="book-resource-type" content="Guide">
    <meta scheme="apple_ref" id="identifier" name="identifier" content="//apple_ref/doc/uid/TP40011210">
    <meta id="document-version" name="document-version" content="2.7.1">
    <meta id="build" name="build" content="ded95564c405529dbbbe590063edd114" />
    <meta id="chapterId" name="chapterId" content="TP40011210-CH5">
    <meta id="date" name="date" content="2014-09-17">
    <meta id="description" name="description" content="Describes elements of best practice when writing code with Objective-C using ARC.">
    <meta id="book-title" name="book-title" content="Programming with Objective-C">
    <meta id="book-root" name="book-root" content="../">
    <meta id="book-json" name="book-json" content="../book.json">
    <meta id="devcenter" name="devcenter" content="Mac Dev Center">
    <meta id="devcenter-url" name="devcenter-url" content="http://developer.apple.com/devcenter/mac">
    <meta id="reflib" name="reflib" content="Guides and Sample Code">
    <meta id="book-assignments" name="book-assignments" content="{Type/Guide}, {Topic/Languages & Utilities/Objective-C}">
    
    
    <meta id="copyright" name="copyright" content="Copyright 2017 Apple Inc. All Rights Reserved.">
    <meta id="xcode-display" name="xcode-display" content="render">
    <meta id="IndexTitle" name="IndexTitle" content="Programming with Objective-C: Encapsulating Data">
    <meta id="resources-uri" name="resources-uri" content="../../../../../Resources/1260">
    <link id="book-index-page" rel="Start" title="Programming with Objective-C" type="text/html" href="../index.html">
    <link id="next-page" rel="Next" type="text/html" href="../CustomizingExistingClasses/CustomizingExistingClasses.html">
    <link id="previous-page" rel="Prev" type="text/html" href="../WorkingwithObjects/WorkingwithObjects.html">
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1260/CSS/screen.css">
    
    <!-- xcode_css -->
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1260/CSS/feedback.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta id="platforms" name="platforms" content="">
</head>    
<body><a name="//apple_ref/doc/uid/TP40011210-CH5" title="Encapsulating Data"></a>
    <div id="_omniture_top">
    <!-- SiteCatalyst code version: H.8. Copyright 1997-2006 Omniture, Inc. -->
    <script type="text/javascript">
    /* RSID: */
    var s_account="appleglobal,appleusdeveloper,dappdeveloperlib"
    </script>

    <script type="text/javascript" src="https://www.apple.com/metrics/scripts/s_code_h.js"></script>
    <script type="text/javascript">
    s.pageName=AC.Tracking.pageName();
    s.channel="www.us.developer"

    /************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
    var s_code=s.t();if(s_code)document.write(s_code)</script>
    <!-- End SiteCatalyst code version: H.8. -->
    </div>

    <div id="adcHeader" class="hideOnPrint hideInXcode">
        <div id='ssi_Header' class="hideInXcode unified">
            <a id="ssi_LibraryTitle" href='../../../../../navigation/'>Guides and Sample Code</a>
            <a id="ssi_AppleDeveloperConnection" href='https://developer.apple.com/'>Developer</a>
            <div id='ssi_SearchButton' role="button" title="Search">Search</div>
        </div>
        <form id='ssi_SearchMenu' method='get' action='../../../../../search/' accept-charset='utf-8'>
            <label for='adcsearch'>Search Guides and Sample Code</label>
            
            
    
            <input type='search' id='ssi_SearchField' name='q' accesskey='s' results='5' />
        </form>
    </div>

    <header id="header">
        <div id="title" role="banner">
            <h1>Programming with Objective-C</h1>
            <span id="file_links">
                <a id="PDF_link" role="button" tabindex='4' rel="alternate" title="Download PDF"><span id="pdf_icon"></span>PDF</a>
                <a id="Companion_link" role="button" tabindex='3' title="Download Companion File"><span id="companion_icon"></span>Companion File</a>
            </span>
        </div>
        <ul id="headerButtons" class="hideOnPrint" role="toolbar">
            <li id="toc_button" style="display:none">
                <button tabindex="5" id="table_of_contents" class="open" role="checkbox" aria-label="Show Table of Contents"><span class="disclosure"></span>Table of Contents</button>
            </li>
            <li id="jumpto_button" style="display:none" role="navigation"><select tabindex="6" id="jumpTo"><option value="top">Jump To&#133;</option></select></li>
            <li id="downloadSample_button" style="display:none">
                <a id="Sample_link"><button id="Sample_button">Download Sample Code</button></a>
            </li>
        </ul>
    </header>
    <nav id="tocContainer" tabindex="7">
        <ul id="toc" role="tree"></ul>
    </nav>

    <article id="contents" tabindex="0" role="main">
        <div id="pageNavigationLinks_top" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='../CustomizingExistingClasses/CustomizingExistingClasses.html'>Next</a><a class='previousLink' rel='prev' href='../WorkingwithObjects/WorkingwithObjects.html'>Previous</a>
        </div>
        <a id="top" name="top"></a>
        <a id="INDEX" href="../index.html" style="display:none;"></a>
        
        <a name="//apple_ref/doc/uid/TP40011210-CH5-SW1" title="Encapsulating Data"></a><h1 id="pageTitle">Encapsulating Data</h1><p>In addition to the messaging behavior covered in the previous chapter, an object also encapsulates data through its properties.</p><p>This chapter describes the Objective-C syntax used to declare properties for an object and explains how those properties are implemented by default through synthesis of accessor methods and instance variables. If a property is backed by an instance variable, that variable must be set correctly in any initialization methods.</p><p>If an object needs to maintain a link to another object through a property, it’s important to consider the nature of the relationship between the two objects. Although memory management for Objective-C objects is mostly handled for you through Automatic Reference Counting (ARC), it’s important to know how to avoid problems like strong reference cycles, which lead to memory leaks. This chapter explains the lifecycle of an object, and describes how to think in terms of managing your graph of objects through relationships.</p><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW2" title="Properties Encapsulate an Object’s Values"></a><h2 class="jump">Properties Encapsulate an Object’s Values</h2><p>Most objects need to keep track of information in order to perform their tasks. Some objects are designed to model one or more values, such as a Cocoa <code>NSNumber</code> class to hold a numeric value or a custom <code>XYZPerson</code> class to model a person with a first and last name. Some objects are more general in scope, perhaps handling the interaction between a user interface and the information it displays, but even these objects need to keep track of user interface elements or the related model objects.</p><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW4" title="Declare Public Properties for Exposed Data"></a><h3 class="jump">Declare Public Properties for Exposed Data</h3><p>Objective-C properties offer a way to define the information that a class is intended to encapsulate. As you saw in <span class="content_text"><a href="../DefiningClasses/DefiningClasses.html#//apple_ref/doc/uid/TP40011210-CH3-SW7" data-renderer-version="1">Properties Control Access to an Object’s Values</a></span>, property declarations are included in the interface for a class, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@interface XYZPerson : NSObject<span></span></pre></td></tr><tr><td scope="row"><pre>@property NSString *firstName;<span></span></pre></td></tr><tr><td scope="row"><pre>@property NSString *lastName;<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><p>In this example, the <code>XYZPerson</code> class declares string properties to hold a person’s first and last name.</p><p>Given that one of the primary principles in object-oriented programming is that an object should hide its internal workings behind its public interface, it’s important to access an object’s properties using behavior exposed by the object rather than trying to gain access to the internal values directly.</p></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW5" title="Use Accessor Methods to Get or Set Property Values"></a><h3 class="jump">Use Accessor Methods to Get or Set Property Values</h3><p>You access or set an object’s properties via accessor methods:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSString *firstName = [somePerson firstName];<span></span></pre></td></tr><tr><td scope="row"><pre>    [somePerson setFirstName:@"Johnny"];<span></span></pre></td></tr></table></div><p>By default, these accessor methods are synthesized automatically for you by the compiler, so you don’t need to do anything other than declare the property using <code>@property</code> in the class interface.</p><p>The synthesized methods follow specific naming conventions:</p><ul class="ul"><li class="li"><p>The method used to access the value (the <em class="newTerm">getter</em> method) has the same name as the property. </p><p>The getter method for a property called <code>firstName</code> will also be called <code>firstName</code>.</p></li><li class="li"><p>The method used to set the value (the <em class="newTerm">setter</em> method) starts with the word “set” and then uses the capitalized property name.</p><p>The setter method for a property called <code>firstName</code> will be called <code>setFirstName:</code>.</p></li></ul><p>If you don’t want to allow a property to be changed via a setter method, you can add an attribute to a property declaration to specify that it should be <code>readonly</code>:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@property (readonly) NSString *fullName;<span></span></pre></td></tr></table></div><p>As well as showing other objects how they are supposed to interact with the property, attributes also tell the compiler how to synthesize the relevant accessor methods.</p><p>In this case, the compiler will synthesize a <code>fullName</code> getter method, but not a <code>setFullName:</code> method.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW7" title="Note"></a><p><strong>Note:</strong>&nbsp;The opposite of <code>readonly</code> is <code>readwrite</code>. There’s no need to specify the <code>readwrite</code> attribute explicitly, because it is the default.</p><p></p></aside></div><p>If you want to use a different name for an accessor method, it’s possible to specify a custom name by adding attributes to the property. In the case of Boolean properties (properties that have a <code><!--a  -->YES<!--/a--></code> or <code><!--a  -->NO<!--/a--></code> value), it’s customary for the getter method to start with the word “is.” The getter method for a property called <code>finished</code>, for example, should be called <code>isFinished</code>.</p><p>Again, it’s possible to add an attribute on the property:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@property (getter=isFinished) BOOL finished;<span></span></pre></td></tr></table></div><p>If you need to specify multiple attributes, simply include them as a comma-separated list, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@property (readonly, getter=isFinished) BOOL finished;<span></span></pre></td></tr></table></div><p>In this case, the compiler will synthesize only an <code>isFinished</code> method, but not a <code>setFinished:</code> method.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW9" title="Note"></a><p><strong>Note:</strong>&nbsp;In general, property accessor methods should be Key-Value Coding (KVC) compliant, which means that they follow explicit naming conventions. </p><p>See <em><a href="../../KeyValueCoding/index.html#//apple_ref/doc/uid/10000107i" data-renderer-version="2" target="_self">Key-Value Coding Programming Guide</a></em> for more information.</p><p></p></aside></div></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW10" title="Dot Syntax Is a Concise Alternative to Accessor Method Calls"></a><h3 class="jump">Dot Syntax Is a Concise Alternative to Accessor Method Calls</h3><p>As well as making explicit accessor method calls, Objective-C offers an alternative dot syntax to access an object’s properties.</p><p>Dot syntax allows you to access properties like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSString *firstName = somePerson.firstName;<span></span></pre></td></tr><tr><td scope="row"><pre>    somePerson.firstName = @"Johnny";<span></span></pre></td></tr></table></div><p>Dot syntax is purely a convenient wrapper around accessor method calls. When you use dot syntax, the property is still accessed or changed using the getter and setter methods mentioned above:</p><ul class="ul"><li class="li"><p>Getting a value using <code>somePerson.firstName</code> is the same as using <code>[somePerson firstName]</code></p></li><li class="li"><p>Setting a value using <code>somePerson.firstName = @"Johnny"</code> is the same as using <code>[somePerson setFirstName:@"Johnny"]</code></p></li></ul><p>This means that property access via dot syntax is also controlled by the property attributes. If a property is marked <code>readonly</code>, you’ll get a compiler error if you try to set it using dot syntax. </p></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW6" title="Most Properties Are Backed by Instance Variables"></a><h3 class="jump">Most Properties Are Backed by Instance Variables</h3><p>By default, a <code>readwrite</code> property will be backed by an instance variable, which will again be synthesized automatically by the compiler.</p><p>An instance variable is a variable that exists and holds its value for the life of the object. The memory used for instance variables is allocated when the object is first created (through <code>alloc</code>), and freed when the object is deallocated.</p><p>Unless you specify otherwise, the synthesized instance variable has the same name as the property, but with an underscore prefix. For a property called <code>firstName</code>, for example, the synthesized instance variable will be called <code>_firstName</code>.</p><p>Although it’s best practice for an object to access its own properties using accessor methods or dot syntax, it’s possible to access the instance variable directly from any of the instance methods in a class implementation. The underscore prefix makes it clear that you’re accessing an instance variable rather than, for example, a local variable:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (void)someMethod {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *myString = @"An interesting string";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    _someString = myString;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>In this example, it’s clear that <code>myString</code> is a local variable and <code>_someString</code> is an instance variable.</p><p>In general, you should use accessor methods or dot syntax for property access even if you’re accessing an object’s properties from within its own implementation, in which case you should use <code>self</code>:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (void)someMethod {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *myString = @"An interesting string";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    self.someString = myString;<span></span></pre></td></tr><tr><td scope="row"><pre>  // or<span></span></pre></td></tr><tr><td scope="row"><pre>    [self setSomeString:myString];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The exception to this rule is when writing initialization, deallocation or custom accessor methods, as described later in this section.</p><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW16" title="You Can Customize Synthesized Instance Variable Names"></a><h4 class="jump">You Can Customize Synthesized Instance Variable Names</h4><p>As mentioned earlier, the default behavior for a writeable property is to use an instance variable called <code>_propertyName</code>. </p><p>If you wish to use a different name for the instance variable, you need to direct the compiler to synthesize the variable using the following syntax in your implementation:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@implementation YourClass<span></span></pre></td></tr><tr><td scope="row"><pre>@synthesize propertyName = instanceVariableName;<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><p>For example:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@synthesize firstName = ivar_firstName;<span></span></pre></td></tr></table></div><p>In this case, the property will still be called <code>firstName</code>, and be accessible through <code>firstName</code> and <code>setFirstName:</code> accessor methods or dot syntax, but it will be backed by an instance variable called <code>ivar_firstName</code>.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW17" title="Important"></a><p><strong>Important:</strong>&nbsp;If you use <code>@synthesize</code> without specifying an instance variable name, like this:</p><p><div class="codesample clear"><table><tr><td scope="row"><pre>@synthesize firstName;<span></span></pre></td></tr></table></div>the instance variable will bear the same name as the property. </p><p>In this example, the instance variable will also be called <code>firstName</code>, without an underscore.</p><p></p></aside></div></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW23" title="You Can Define Instance Variables without Properties"></a><h4 class="jump">You Can Define Instance Variables without Properties</h4><p>It’s best practice to use a property on an object any time you need to keep track of a value or another object.</p><p>If you do need to define your own instance variables without declaring a property, you can add them inside braces at the top of the class interface or implementation, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@interface SomeClass : NSObject {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *_myNonPropertyInstanceVariable;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@implementation SomeClass {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *_anotherCustomInstanceVariable;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW24" title="Note"></a><p><strong>Note:</strong>&nbsp;You can also add instance variables at the top of a class extension, as described in <span class="content_text"><a href="../CustomizingExistingClasses/CustomizingExistingClasses.html#//apple_ref/doc/uid/TP40011210-CH6-SW3" data-renderer-version="1">Class Extensions Extend the Internal Implementation</a></span>.</p><p></p></aside></div></section></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW11" title="Access Instance Variables Directly from Initializer Methods"></a><h3 class="jump">Access Instance Variables Directly from Initializer Methods</h3><p>Setter methods can have additional side-effects. They may trigger KVC notifications, or perform further tasks if you write your own custom methods.</p><p>You should always access the instance variables directly from within an initialization method because at the time a property is set, the rest of the object may not yet be completely initialized. Even if you don’t provide custom accessor methods or know of any side effects from within your own class, a future subclass may very well override the behavior.</p><p>A typical <code>init</code> method looks like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (id)init {<span></span></pre></td></tr><tr><td scope="row"><pre>    self = [super init];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (self) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // initialize instance variables here<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return self;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>An <code>init</code> method should assign <code>self</code> to the result of calling the superclass’s initialization method before doing its own initialization. A superclass may fail to initialize the object correctly and return <code>nil</code> so you should always check to make sure <code>self</code> is not <code>nil</code> before performing your own initialization.</p><p>By calling <code>[super init]</code> as the first line in the method, an object is initialized from its root class down through each subclass <code>init</code> implementation in order. <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW12" data-renderer-version="1">Figure 3-1</a></span> shows the process for initializing an <code>XYZShoutingPerson</code> object.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH5-SW12" title="Figure 3-1The initialization process"></a><figcaption><strong class="caption_number">Figure 3-1</strong>&nbsp;&nbsp;The initialization process</figcaption><img src="../Art/initflow.png" class="wide-image" alt="" width="719" height="320"><img src="../Art/initflow.png" class="ipad-scaled-image" alt="" width="670" height="298"></figure><p>As you saw in the previous chapter, an object is initialized either by calling <code>init</code>, or by calling a method that initializes the object with specific values.</p><p>In the case of the <code>XYZPerson</code> class, it would make sense to offer an initialization method that set the person’s initial first and last names:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (id)initWithFirstName:(NSString *)aFirstName lastName:(NSString *)aLastName;<span></span></pre></td></tr></table></div><p>You’d implement the method like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (id)initWithFirstName:(NSString *)aFirstName lastName:(NSString *)aLastName {<span></span></pre></td></tr><tr><td scope="row"><pre>    self = [super init];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (self) {<span></span></pre></td></tr><tr><td scope="row"><pre>        _firstName = aFirstName;<span></span></pre></td></tr><tr><td scope="row"><pre>        _lastName = aLastName;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return self;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW8" title="The Designated Initializer is the Primary Initialization Method"></a><h4 class="jump">The Designated Initializer is the Primary Initialization Method</h4><p>If an object declares one or more initialization methods, you should decide which method is the <em class="newTerm">designated initializer</em>. This is often the method that offers the most options for initialization (such as the method with the most arguments), and is called by other methods you write for convenience. You should also typically override <code>init</code> to call your designated initializer with suitable default values.</p><p>If an <code>XYZPerson</code> also had a property for a date of birth, the designated initializer might be:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (id)initWithFirstName:(NSString *)aFirstName lastName:(NSString *)aLastName<span></span></pre></td></tr><tr><td scope="row"><pre>                                            dateOfBirth:(NSDate *)aDOB;<span></span></pre></td></tr></table></div><p>This method would set the relevant instance variables, as shown above. If you still wished to provide a convenience initializer for just first and last names, you would implement the method to call the designated initializer, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (id)initWithFirstName:(NSString *)aFirstName lastName:(NSString *)aLastName {<span></span></pre></td></tr><tr><td scope="row"><pre>    return [self initWithFirstName:aFirstName lastName:aLastName dateOfBirth:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>You might also implement a standard <code>init</code> method to provide suitable defaults:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (id)init {<span></span></pre></td></tr><tr><td scope="row"><pre>    return [self initWithFirstName:@"John" lastName:@"Doe" dateOfBirth:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>If you need to write an initialization method when subclassing a class that uses multiple <code>init</code> methods, you should either override the superclass’s designated initializer to perform your own initialization, or add your own additional initializer. Either way, you should call the superclass’s designated initializer (in place of <code>[super init];</code>) before doing any of your own initialization.</p></section></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW13" title="You Can Implement Custom Accessor Methods"></a><h3 class="jump">You Can Implement Custom Accessor Methods</h3><p>Properties don’t always have to be backed by their own instance variables.</p><p>As an example, the <code>XYZPerson</code> class might define a read-only property for a person’s full name:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@property (readonly) NSString *fullName;<span></span></pre></td></tr></table></div><p>Rather than having to update the <code>fullName</code> property every time the first or last name changed, it would be easier just to write a custom accessor method to build the full name string on request:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (NSString *)fullName {<span></span></pre></td></tr><tr><td scope="row"><pre>    return [NSString stringWithFormat:@"%@ %@", self.firstName, self.lastName];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>This simple example uses a format string and specifiers (as described in the previous chapter) to build a string containing a person’s first and last names separated by a space.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW41" title="Note"></a><p><strong>Note:</strong>&nbsp;Although this is a convenient example, it’s important to realize that it’s locale-specific, and is only suitable for use in countries that put a person’s given name before the family name.</p><p></p></aside></div><p>If you need to write a custom accessor method for a property that does use an instance variable, you must access that instance variable directly from within the method. For example, it’s common to delay the initialization of a property until it’s first requested, using a “lazy accessor,” like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (XYZObject *)someImportantObject {<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!_someImportantObject) {<span></span></pre></td></tr><tr><td scope="row"><pre>        _someImportantObject = [[XYZObject alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return _someImportantObject;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Before returning the value, this method first checks whether the <code>_someImportantObject</code> instance variable is <code>nil</code>; if it is, it allocates an object.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW40" title="Note"></a><p><strong>Note:</strong>&nbsp;The compiler will automatically synthesize an instance variable in all situations where it’s also synthesizing at least one accessor method. If you implement both a getter and a setter for a <code>readwrite</code> property, or a getter for a <code>readonly</code> property, the compiler will assume that you are taking control over the property implementation and won’t synthesize an instance variable automatically.</p><p>If you still need an instance variable, you’ll need to request that one be synthesized:</p><p><div class="codesample clear"><table><tr><td scope="row"><pre>@synthesize property = _property;<span></span></pre></td></tr></table></div></p></aside></div></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW37" title="Properties Are Atomic by Default"></a><h3 class="jump">Properties Are Atomic by Default</h3><p>By default, an Objective-C property is <em class="newTerm">atomic</em>:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@interface XYZObject : NSObject<span></span></pre></td></tr><tr><td scope="row"><pre>@property NSObject *implicitAtomicObject;          // atomic by default<span></span></pre></td></tr><tr><td scope="row"><pre>@property (atomic) NSObject *explicitAtomicObject; // explicitly marked atomic<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><p>This means that the synthesized accessors ensure that a value is always fully retrieved by the getter method or fully set via the setter method, even if the accessors are called simultaneously from different threads.</p><p>Because the internal implementation and synchronization of atomic accessor methods is private, it’s not possible to combine a synthesized accessor with an accessor method that you implement yourself. You’ll get a compiler warning if you try, for example, to provide a custom setter for an <code>atomic</code>, <code>readwrite</code> property but leave the compiler to synthesize the getter.</p><p>You can use the <code>nonatomic</code> property attribute to specify that synthesized accessors simply set or return a value directly, with no guarantees about what happens if that same value is accessed simultaneously from different threads. For this reason, it’s faster to access a <code>nonatomic</code> property than an <code>atomic</code> one, and it’s fine to combine a synthesized setter, for example, with your own getter implementation:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@interface XYZObject : NSObject<span></span></pre></td></tr><tr><td scope="row"><pre>@property (nonatomic) NSObject *nonatomicObject;<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><div class="codesample clear"><table><tr><td scope="row"><pre>@implementation XYZObject<span></span></pre></td></tr><tr><td scope="row"><pre>- (NSObject *)nonatomicObject {<span></span></pre></td></tr><tr><td scope="row"><pre>    return _nonatomicObject;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>// setter will be synthesized automatically<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW38" title="Note"></a><p><strong>Note:</strong>&nbsp;Property atomicity is not synonymous with an object’s <em class="newTerm">thread safety</em>.</p><p>Consider an <code>XYZPerson</code> object in which both a person’s first and last names are changed using atomic accessors from one thread. If another thread accesses both names at the same time, the atomic getter methods will return complete strings (without crashing), but there’s no guarantee that those values will be the right names relative to each other. If the first name is accessed before the change, but the last name is accessed after the change, you’ll end up with an inconsistent, mismatched pair of names.</p><p>This example is quite simple, but the problem of thread safety becomes much more complex when considered across a network of related objects. Thread safety is covered in more detail in <em><a href="../../../../General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008091" data-renderer-version="1" target="_self">Concurrency Programming Guide</a></em>.</p><p></p></aside></div></section></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW3" title="Manage the Object Graph through Ownership and Responsibility"></a><h2 class="jump">Manage the Object Graph through Ownership and Responsibility</h2><p>As you’ve already seen, memory for Objective-C objects is allocated dynamically (on the heap), which means you need to use pointers to keep track of an object’s address. Unlike scalar values, it’s not always possible to determine an object’s lifetime by the scope of one pointer variable. Instead, an object must be kept active in memory for as long as it is needed by other objects.</p><p>Rather than trying to worry about managing the lifecycle of each object manually, you should instead think about the relationships between objects. </p><p>In the case of an <code>XYZPerson</code> object, for example, the two string properties for <code>firstName</code> and <code>lastName</code> are effectively “owned” by the <code>XYZPerson</code> instance. This means they should stay in memory as long as the <code>XYZPerson</code> object stays in memory.</p><p>When one object relies on other objects in this way, effectively taking ownership of those other objects, the first object is said to have <em class="newTerm">strong references</em> to the other objects. In Objective-C, an object is kept alive as long as it has at least one strong reference to it from another object. The relationships between the <code>XYZPerson</code> instance and the two <code>NSString</code> objects is shown in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW14" data-renderer-version="1">Figure 3-2</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH5-SW14" title="Figure 3-2Strong Relationships"></a><figcaption><strong class="caption_number">Figure 3-2</strong>&nbsp;&nbsp;Strong Relationships</figcaption><img src="../Art/strongpersonproperties.png" alt="" width="423" height="307"></figure><p>When an <code>XYZPerson</code> object is deallocated from memory, the two string objects will also be deallocated, assuming there aren’t any other strong references left to them.</p><p>To add a little more complexity to this example, consider the object graph for an application like that shown in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW18" data-renderer-version="1">Figure 3-3</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH5-SW18" title="Figure 3-3The Name Badge Maker application"></a><figcaption><strong class="caption_number">Figure 3-3</strong>&nbsp;&nbsp;The Name Badge Maker application</figcaption><img src="../Art/namebadgemaker.png" alt="" width="429" height="485"></figure><p>When the user clicks the Update button, the badge preview is updated with the relevant name information.</p><p>The first time a person’s details are entered and the update button clicked, the simplified object graph might look like <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW19" data-renderer-version="1">Figure 3-4</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH5-SW19" title="Figure 3-4Simplified object graph for initial XYZPerson creation"></a><figcaption><strong class="caption_number">Figure 3-4</strong>&nbsp;&nbsp;Simplified object graph for initial XYZPerson creation</figcaption><img src="../Art/simplifiedobjectgraph1.png" class="wide-image" alt="" width="730" height="368"><img src="../Art/simplifiedobjectgraph1.png" class="ipad-scaled-image" alt="" width="670" height="337"></figure><p>When the user modifies the person’s first name, the object graph changes to look like <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW20" data-renderer-version="1">Figure 3-5</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH5-SW20" title="Figure 3-5Simplified object graph while changing the person’s first name"></a><figcaption><strong class="caption_number">Figure 3-5</strong>&nbsp;&nbsp;Simplified object graph while changing the person’s first name</figcaption><img src="../Art/simplifiedobjectgraph2.png" class="wide-image" alt="" width="730" height="368"><img src="../Art/simplifiedobjectgraph2.png" class="ipad-scaled-image" alt="" width="670" height="337"></figure><p>The badge display view maintains a strong relationship to the original <code>@"John"</code> string object, even though the <code>XYZPerson</code> object now has a different <code>firstName</code>. This means the <code>@"John"</code> object stays in memory, used by the badge view to print the name.</p><p>Once the user clicks the Update button a second time, the badge view is told to update its internal properties to match the person object, so the object graph looks like <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW21" data-renderer-version="1">Figure 3-6</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH5-SW21" title="Figure 3-6Simplified object graph after updating the badge view"></a><figcaption><strong class="caption_number">Figure 3-6</strong>&nbsp;&nbsp;Simplified object graph after updating the badge view</figcaption><img src="../Art/simplifiedobjectgraph3.png" class="wide-image" alt="" width="730" height="368"><img src="../Art/simplifiedobjectgraph3.png" class="ipad-scaled-image" alt="" width="670" height="337"></figure><p>At this point, the original <code>@"John"</code> object no longer has any strong references to it, so it is removed from memory.</p><p>By default, both Objective-C properties and variables maintain strong references to their objects. This is fine for many situations, but it does cause a potential problem with strong reference cycles.</p><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW22" title="Avoid Strong Reference Cycles"></a><h3 class="jump">Avoid Strong Reference Cycles</h3><p>Although strong references work well for one-way relationships between objects, you need to be careful when working with groups of interconnected objects. If a group of objects is connected by a circle of strong relationships, they keep each other alive even if there are no strong references from outside the group.</p><p>One obvious example of a potential reference cycle exists between a table view object (<code>UITableView</code> for iOS and <code>NSTableView</code> for OS X) and its delegate. In order for a generic table view class to be useful in multiple situations, it <span class="pediaLink" data-header="Delegation" data-contents="Delegation is a simple and powerful pattern in which one object in a program acts on behalf of, or in coordination with, another object. "><a href="../../../../General/Conceptual/DevPedia-CocoaCore/Delegation.html#//apple_ref/doc/uid/TP40008195-CH14" data-renderer-version="1" target="_self">delegates</a></span> some decisions to external objects. This means it relies on another object to decide what content it displays, or what to do if the user interacts with a specific entry in the table view.</p><p>A common scenario is that the table view has a reference to its delegate and the delegate has a reference back to the table view, as shown in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW25" data-renderer-version="1">Figure 3-7</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH5-SW25" title="Figure 3-7Strong references between a table view and its delegate"></a><figcaption><strong class="caption_number">Figure 3-7</strong>&nbsp;&nbsp;Strong references between a table view and its delegate</figcaption><img src="../Art/strongreferencecycle1.png" alt="" width="622" height="216"></figure><p>A problem occurs if the other objects give up their strong relationships to the table view and delegate, as shown in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW26" data-renderer-version="1">Figure 3-8</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH5-SW26" title="Figure 3-8A strong reference cycle"></a><figcaption><strong class="caption_number">Figure 3-8</strong>&nbsp;&nbsp;A strong reference cycle</figcaption><img src="../Art/strongreferencecycle2.png" alt="" width="622" height="181"></figure><p>Even though there is no need for the objects to be kept in memory—there are no strong relationships to the table view or delegate other than the relationships between the two objects—the two remaining strong relationships keep the two objects alive. This is known as a <em class="newTerm">strong reference cycle</em>.</p><p>The way to solve this problem is to substitute one of the strong references for a <em class="newTerm">weak reference</em>. A weak reference does not imply ownership or responsibility between two objects, and does not keep an object alive.</p><p>If the table view is modified to use a weak relationship to its delegate (which is how <code>UITableView</code> and <code>NSTableView</code> solve this problem), the initial object graph now looks like <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW27" data-renderer-version="1">Figure 3-9</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH5-SW27" title="Figure 3-9The correct relationship between a table view and its delegate"></a><figcaption><strong class="caption_number">Figure 3-9</strong>&nbsp;&nbsp;The correct relationship between a table view and its delegate</figcaption><img src="../Art/strongreferencecycle3.png" alt="" width="622" height="216"></figure><p>When the other objects in the graph give up their strong relationships to the table view and delegate this time, there are no strong references left to the delegate object, as shown in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW28" data-renderer-version="1">Figure 3-10</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH5-SW28" title="Figure 3-10Avoiding a strong reference cycle"></a><figcaption><strong class="caption_number">Figure 3-10</strong>&nbsp;&nbsp;Avoiding a strong reference cycle</figcaption><img src="../Art/strongreferencecycle4.png" alt="" width="622" height="181"></figure><p>This means that the delegate object will be deallocated, thereby releasing the strong reference on the table view, as shown in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW29" data-renderer-version="1">Figure 3-11</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH5-SW29" title="Figure 3-11Deallocating the delegate"></a><figcaption><strong class="caption_number">Figure 3-11</strong>&nbsp;&nbsp;Deallocating the delegate</figcaption><img src="../Art/strongreferencecycle5.png" alt="" width="622" height="181"></figure><p>Once the delegate is deallocated, there are no longer any strong references to the table view, so it too is deallocated.</p></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW30" title="Use Strong and Weak Declarations to Manage Ownership"></a><h3 class="jump">Use Strong and Weak Declarations to Manage Ownership</h3><p>By default, object properties declared like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@property id delegate;<span></span></pre></td></tr></table></div><p>use strong references for their synthesized instance variables. To declare a weak reference, add an attribute to the property, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@property (weak) id delegate;<span></span></pre></td></tr></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW31" title="Note"></a><p><strong>Note:</strong>&nbsp;The opposite to <code>weak</code> is <code>strong</code>. There’s no need to specify the <code>strong</code> attribute explicitly, because it is the default.</p><p></p></aside></div><p>Local variables (and non-property instance variables) also maintain strong references to objects by default. This means that the following code will work exactly as you expect:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSDate *originalDate = self.lastModificationDate;<span></span></pre></td></tr><tr><td scope="row"><pre>    self.lastModificationDate = [NSDate date];<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"Last modification date changed from %@ to %@",<span></span></pre></td></tr><tr><td scope="row"><pre>                        originalDate, self.lastModificationDate);<span></span></pre></td></tr></table></div><p>In this example, the local variable <code>originalDate</code> maintains a strong reference to the initial <code>lastModificationDate</code> object. When the <code>lastModificationDate</code> property is changed, the property no longer keeps a strong reference to the original date, but that date is still kept alive by the <code>originalDate</code> strong variable. </p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW34" title="Note"></a><p><strong>Note:</strong>&nbsp;A variable maintains a strong reference to an object only as long as that variable is in scope, or until it is reassigned to another object or <code>nil</code>.</p><p></p></aside></div><p>If you don’t want a variable to maintain a strong reference, you can declare it as <code>__weak</code>, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSObject * __weak weakVariable;<span></span></pre></td></tr></table></div><p>Because a weak reference doesn’t keep an object alive, it’s possible for the referenced object to be deallocated while the reference is still in use. To avoid a dangerous dangling pointer to the memory originally occupied by the now deallocated object, a weak reference is automatically set to <code>nil</code> when its object is deallocated.</p><p>This means that if you use a weak variable in the previous date example:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSDate * __weak originalDate = self.lastModificationDate;<span></span></pre></td></tr><tr><td scope="row"><pre>    self.lastModificationDate = [NSDate date];<span></span></pre></td></tr></table></div><p>the <code>originalDate</code> variable may potentially be set to <code>nil</code>. When <code>self.lastModificationDate</code> is reassigned, the property no longer maintains a strong reference to the original date. If there are no other strong references to it, the original date will be deallocated and <code>originalDate</code> set to <code>nil</code>.</p><p>Weak variables can be a source of confusion, particularly in code like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSObject * __weak someObject = [[NSObject alloc] init];<span></span></pre></td></tr></table></div><p>In this example, the newly allocated object has no strong references to it, so it is immediately deallocated and <code>someObject</code> is set to <code>nil</code>.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW32" title="Note"></a><p><strong>Note:</strong>&nbsp;The opposite to <code>__weak</code> is <code>__strong</code>. Again, you don’t need to specify <code>__strong</code> explicitly, because it is the default.</p><p></p></aside></div><p>It’s also important to consider the implications of a method that needs to access a weak property several times, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (void)someMethod {<span></span></pre></td></tr><tr><td scope="row"><pre>    [self.weakProperty doSomething];<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre>    [self.weakProperty doSomethingElse];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>In situations like this, you might want to cache the weak property in a strong variable to ensure that it is kept in memory as long as you need to use it:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (void)someMethod {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSObject *cachedObject = self.weakProperty;<span></span></pre></td></tr><tr><td scope="row"><pre>    [cachedObject doSomething];<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre>    [cachedObject doSomethingElse];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>In this example, the <code>cachedObject</code> variable maintains a strong reference to the original weak property value so that it can’t be deallocated as long as <code>cachedObject</code> is still in scope (and hasn’t been reassigned another value).</p><p>It’s particularly important to keep this in mind if you need to make sure a weak property is not <code>nil</code> before using it. It’s not enough just to test it, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    if (self.someWeakProperty) {<span></span></pre></td></tr><tr><td scope="row"><pre>        [someObject doSomethingImportantWith:self.someWeakProperty];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>because in a multi-threaded application, the property may be deallocated between the test and the method call, rendering the test useless. Instead, you need to declare a strong local variable to cache the value, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSObject *cachedObject = self.someWeakProperty;           // 1<span></span></pre></td></tr><tr><td scope="row"><pre>    if (cachedObject) {                                       // 2<span></span></pre></td></tr><tr><td scope="row"><pre>        [someObject doSomethingImportantWith:cachedObject];   // 3<span></span></pre></td></tr><tr><td scope="row"><pre>    }                                                         // 4<span></span></pre></td></tr><tr><td scope="row"><pre>    cachedObject = nil;                                       // 5<span></span></pre></td></tr></table></div><p>In this example, the strong reference is created in line 1, meaning that the object is guaranteed to be alive for the test and method call. In line 5, <code>cachedObject</code> is set to <code>nil</code>, thereby giving up the strong reference. If the original object has no other strong references to it at this point, it will be deallocated and <code>someWeakProperty</code> will be set to <code>nil</code>.</p></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW33" title="Use Unsafe Unretained References for Some Classes"></a><h3 class="jump">Use Unsafe Unretained References for Some Classes</h3><p>There are a few classes in Cocoa and Cocoa Touch that don’t yet support weak references, which means you can’t declare a weak property or weak local variable to keep track of them. These classes include <code>NSTextView</code>, <code>NSFont</code> and <code>NSColorSpace</code>; for the full list, see <em><a href="../../../../../releasenotes/ObjectiveC/RN-TransitioningToARC/Introduction/Introduction.html#//apple_ref/doc/uid/TP40011226" data-renderer-version="1" target="_self">Transitioning to ARC Release Notes</a></em>.</p><p>If you need to use a weak reference to one of these classes, you must use an unsafe reference. For a property, this means using the <code>unsafe_unretained</code> attribute:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@property (unsafe_unretained) NSObject *unsafeProperty;<span></span></pre></td></tr></table></div><p>For variables, you need to use <code>__unsafe_unretained</code>:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSObject * __unsafe_unretained unsafeReference;<span></span></pre></td></tr></table></div><p>An unsafe reference is similar to a weak reference in that it doesn’t keep its related object alive, but it won’t be set to <code>nil</code> if the destination object is deallocated. This means that you’ll be left with a dangling pointer to the memory originally occupied by the now deallocated object, hence the term “unsafe.” Sending a message to a dangling pointer will result in a crash.</p></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW35" title="Copy Properties Maintain Their Own Copies"></a><h3 class="jump">Copy Properties Maintain Their Own Copies</h3><p>In some circumstances, an object may wish to keep its own copy of any objects that are set for its properties.</p><p>As an example, the class interface for the <code>XYZBadgeView</code> class shown earlier in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH5-SW19" data-renderer-version="1">Figure 3-4</a></span> might look like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@interface XYZBadgeView : NSView<span></span></pre></td></tr><tr><td scope="row"><pre>@property NSString *firstName;<span></span></pre></td></tr><tr><td scope="row"><pre>@property NSString *lastName;<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><p>Two <code>NSString</code> properties are declared, which both maintain implicit strong references to their objects.</p><p>Consider what happens if another object creates a string to set as one of the badge view’s properties, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSMutableString *nameString = [NSMutableString stringWithString:@"John"];<span></span></pre></td></tr><tr><td scope="row"><pre>    self.badgeView.firstName = nameString;<span></span></pre></td></tr></table></div><p>This is perfectly valid, because <code>NSMutableString</code> is a subclass of <code>NSString</code>. Although the badge view thinks it’s dealing with an <code>NSString</code> instance, it’s actually dealing with an <code>NSMutableString</code>.</p><p>This means that the string can change:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    [nameString appendString:@"ny"];<span></span></pre></td></tr></table></div><p>In this case, although the name was “John” at the time it was originally set for the badge view’s <code>firstName</code> property, it’s now “Johnny” because the mutable string was changed.</p><p>You might choose that the badge view should maintain its own copies of any strings set for its <code>firstName</code> and <code>lastName</code> properties, so that it effectively captures the strings at the time that the properties are set. By adding a <code>copy</code> attribute to the two property declarations:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@interface XYZBadgeView : NSView<span></span></pre></td></tr><tr><td scope="row"><pre>@property (copy) NSString *firstName;<span></span></pre></td></tr><tr><td scope="row"><pre>@property (copy) NSString *lastName;<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><p>the view now maintains its own copies of the two strings. Even if a mutable string is set and subsequently changed, the badge view captures whatever value it has at the time it is set. For example:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSMutableString *nameString = [NSMutableString stringWithString:@"John"];<span></span></pre></td></tr><tr><td scope="row"><pre>    self.badgeView.firstName = nameString;<span></span></pre></td></tr><tr><td scope="row"><pre>    [nameString appendString:@"ny"];<span></span></pre></td></tr></table></div><p>This time, the <code>firstName</code> held by the badge view will be an unaffected copy of the original “John” string.</p><p>The <code>copy</code> attribute means that the property will use a strong reference, because it must hold on to the new object it creates.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW36" title="Note"></a><p><strong>Note:</strong>&nbsp;Any object that you wish to set for a <code>copy</code> property must support <code>NSCopying</code>, which means that it should conform to the <code>NSCopying</code> protocol.</p><p>Protocols are described in <span class="content_text"><a href="../WorkingwithProtocols/WorkingwithProtocols.html#//apple_ref/doc/uid/TP40011210-CH11-SW2" data-renderer-version="1">Protocols Define Messaging Contracts</a></span>. For more information on <code>NSCopying</code>, see <code><a href="https://developer.apple.com/reference/foundation/nscopying" target="_self" class="urlLink">NSCopying</a></code> or the <em><a href="../../MemoryMgmt/Articles/MemoryMgmt.html#//apple_ref/doc/uid/10000011i" data-renderer-version="1" target="_self">Advanced Memory Management Programming Guide</a></em>.</p><p></p></aside></div><p>If you need to set a <code>copy</code> property’s instance variable directly, for example in an initializer method, don’t forget to set a copy of the original object:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (id)initWithSomeOriginalString:(NSString *)aString {<span></span></pre></td></tr><tr><td scope="row"><pre>    self = [super init];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (self) {<span></span></pre></td></tr><tr><td scope="row"><pre>        _instanceVariableForCopyProperty = [aString copy];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return self;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section></section><section><a name="//apple_ref/doc/uid/TP40011210-CH5-SW15" title="Exercises"></a><h2 class="jump">Exercises</h2><ol class="ol"><li class="li"><p>Modify the <code>sayHello</code> method from the <code>XYZPerson</code> class to log a greeting using the person’s first name and last name.</p></li><li class="li"><p>Declare and implement a new designated initializer used to create an <code>XYZPerson</code> using a specified first name, last name and date of birth, along with a suitable class factory method.</p><p>Don’t forget to override <code>init</code> to call the designated initializer.</p></li><li class="li"><p>Test what happens if you set a mutable string as the person’s first name, then mutate that string before calling your modified <code>sayHello</code> method. Change the <code>NSString</code> property declarations by adding the <code>copy</code> attribute and test again.</p></li><li class="li"><p>Try creating <code>XYZPerson</code> objects using a variety of strong and weak variables in the <code>main()</code> function. Verify that the strong variables keep the <code>XYZPerson</code> objects alive at least as long as you expect.</p><p>In order to help verify when an <code>XYZPerson</code> object is deallocated, you might want to tie into the object lifecycle by providing a <code>dealloc</code> method in the <code>XYZPerson</code> implementation. This method is called automatically when an Objective-C object is deallocated from memory, and is normally used to release any memory you allocated manually, such as through the C <code>malloc()</code> function, as described in <em><a href="../../MemoryMgmt/Articles/MemoryMgmt.html#//apple_ref/doc/uid/10000011i" data-renderer-version="1" target="_self">Advanced Memory Management Programming Guide</a></em>.</p><p>For the purposes of this exercise, override the <code>dealloc</code> method in <code>XYZPerson</code> to log a message, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (void)dealloc {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"XYZPerson is being deallocated");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Try setting each <code>XYZPerson</code> pointer variable to <code>nil</code> to verify that the objects are deallocated when you expect them to be.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH5-SW39" title="Note"></a><p><strong>Note:</strong>&nbsp;The Xcode project template for a Command Line Tool use an <code>@autoreleasepool { }</code> block inside the <code>main()</code> function. In order to use the Automatic Retain Count feature of the compiler to handle memory management for you, it’s important that any code you write in <code>main()</code> goes inside this autorelease pool block.</p><p>Autorelease pools are outside the scope of this document, but are covered in detail in <em><a href="../../MemoryMgmt/Articles/MemoryMgmt.html#//apple_ref/doc/uid/10000011i" data-renderer-version="1" target="_self">Advanced Memory Management Programming Guide</a></em>.</p><p>When you’re writing a Cocoa or Cocoa Touch application rather than a command line tool, you won’t usually need to worry about creating your own autorelease pools, because you’re tying into a framework of objects that will ensure one is already in place.</p><p></p></aside></div></li><li class="li"><p>Modify the <code>XYZPerson</code> class description so that you can keep track of a spouse or partner.</p><p>You’ll need to decide how best to model the relationship, thinking carefully about object graph management.</p></li></ol></section>
        <div id="pageNavigationLinks_bottom" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='../CustomizingExistingClasses/CustomizingExistingClasses.html'>Next</a><a class='previousLink' rel='prev' href='../WorkingwithObjects/WorkingwithObjects.html'>Previous</a>
        </div><br/>
        <div class="copyright"><br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> Copyright &#x00a9; 2014 Apple Inc. All Rights Reserved. <a href="http://www.apple.com/legal/internet-services/terms/site.html" target="_blank">Terms of Use</a>   |  <a href="http://www.apple.com/privacy/" target="_blank">Privacy Policy</a>  |  Updated: 2014-09-17</p></div></div>

        <div id="pediaWindow">
            <div id="pediaHeader"></div>
            <div id="pediaBody"></div>
        </div>
    </article>

    <div id="blackout">
    <div id="preload"></div>
</div>
<div id="leave_feedback" class="button" role="button" tabindex="0">Feedback</div>
<div id="modal" aria-hidden="true">
    <div id="closebox" tabindex="0" aria-label="Close feedback form" role="button"></div>
    <div id="sending" class="hidden">
        <h2 tabindex="0">Sending feedback&hellip;</h2>
        <div id="sending_img"></div>
    </div>
    <div id="error" class="hidden">
        <h2 tabindex="0">We&rsquo;re sorry, an error has occurred.</h2>
        <p>Please try submitting your feedback later.</p>
        <div id="error_icon"></div>
    </div>
    <div id="success" class="hidden">
        <h2 tabindex="0">Thank you for providing feedback!</h2>
        <p>Your input helps improve our developer documentation.</p>
        <div id="thank_you_icon"></div>
    </div>
    
    <form id="feedback" action="#" method="post">
        <div class="left-leaf">
            <h2 id="helpful_title" data-asterisk="a1" tabindex="0">How helpful is this document?</h2>     
            <sup id="a1" class="asterisk" aria-hidden="true">*</sup>

            <div id="star_group" role="radiogroup" aria-required="true">
                <label> 
                    <input class="radio" type="radio" name="helped" value="1" /> 
                    Very helpful
                </label>
                <label> 
                    <input class="radio" type="radio" name="helped" value="2" /> 
                    Somewhat helpful
                </label>
                <label>
                    <input class="radio" type="radio" name="helped" value="3" /> 
                    Not helpful
                </label>
            </div>
        </div>
        <div class="right-leaf">
            <h2>How can we improve this document?</h2>
            <div id="improve" class="checkboxes">
                <label>
                    <input type="checkbox" name="typo" /> 
                    Fix typos or links
                </label>
                <label>
                    <input type="checkbox" name="infoIncorrect" /> 
                    Fix incorrect information
                </label>
                <label>
                    <input type="checkbox" name="needs_examples" /> 
                    Add or update code samples
                </label>
                <label>
                    <input type="checkbox" name="needs_art" /> 
                    Add or update illustrations
                </label>
                <label>
                    <input type="checkbox" name="missingInfo" /> 
                    Add information about...
                </label>
            </div>
        </div>

        <textarea id="comment" name="problem" cols="70" rows="8" placeholder="Please tell us more about your experience with this document" data-asterisk="a2" required></textarea>
        <sup id="a2" class="asterisk" aria-hidden="true">*</sup>

        <p class="fineprint">
            <em aria-hidden="true"><span>*</span> Required information</em>
        </p> 

        <input id="submit" type="button" value="Send" />

        <section id="legal">
            <p>
                To submit a product bug or enhancement request, please visit the 
                <a href="https://developer.apple.com/bugreporter/" target="_blank">Bug Reporter</a> 
                page.
            </p>
            <p>
                Please read <a href="http://www.apple.com/legal/policies/ideas.html" target="_blank">Apple's Unsolicited Idea Submission Policy</a> 
                before you send us your feedback.
            </p> 
        </section>
    </form>
</div>

    
    <script charset="utf-8" src="../../../../../Resources/1260/JavaScript/lib/prototype.js"></script>
    <script src="../../../../../Resources/1260/JavaScript/library.js"></script>
    <script src="../../../../../Resources/1260/JavaScript/feedback.js"></script>
</body>
</html>
