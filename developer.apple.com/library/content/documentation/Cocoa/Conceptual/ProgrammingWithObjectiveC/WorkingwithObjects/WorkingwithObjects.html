<!DOCTYPE html>
<html lang="en">
<head>
    <title>Working with Objects</title>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta charset="utf-8">
    <meta id="book-resource-type" name="book-resource-type" content="Guide">
    <meta scheme="apple_ref" id="identifier" name="identifier" content="//apple_ref/doc/uid/TP40011210">
    <meta id="document-version" name="document-version" content="2.7.1">
    <meta id="build" name="build" content="ded95564c405529dbbbe590063edd114" />
    <meta id="chapterId" name="chapterId" content="TP40011210-CH4">
    <meta id="date" name="date" content="2014-09-17">
    <meta id="description" name="description" content="Describes elements of best practice when writing code with Objective-C using ARC.">
    <meta id="book-title" name="book-title" content="Programming with Objective-C">
    <meta id="book-root" name="book-root" content="../">
    <meta id="book-json" name="book-json" content="../book.json">
    <meta id="devcenter" name="devcenter" content="Mac Dev Center">
    <meta id="devcenter-url" name="devcenter-url" content="http://developer.apple.com/devcenter/mac">
    <meta id="reflib" name="reflib" content="Guides and Sample Code">
    <meta id="book-assignments" name="book-assignments" content="{Type/Guide}, {Topic/Languages & Utilities/Objective-C}">
    
    
    <meta id="copyright" name="copyright" content="Copyright 2017 Apple Inc. All Rights Reserved.">
    <meta id="xcode-display" name="xcode-display" content="render">
    <meta id="IndexTitle" name="IndexTitle" content="Programming with Objective-C: Working with Objects">
    <meta id="resources-uri" name="resources-uri" content="../../../../../Resources/1260">
    <link id="book-index-page" rel="Start" title="Programming with Objective-C" type="text/html" href="../index.html">
    <link id="next-page" rel="Next" type="text/html" href="../EncapsulatingData/EncapsulatingData.html">
    <link id="previous-page" rel="Prev" type="text/html" href="../DefiningClasses/DefiningClasses.html">
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1260/CSS/screen.css">
    
    <!-- xcode_css -->
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1260/CSS/feedback.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta id="platforms" name="platforms" content="">
</head>    
<body><a name="//apple_ref/doc/uid/TP40011210-CH4" title="Working with Objects"></a>
    <div id="_omniture_top">
    <!-- SiteCatalyst code version: H.8. Copyright 1997-2006 Omniture, Inc. -->
    <script type="text/javascript">
    /* RSID: */
    var s_account="appleglobal,appleusdeveloper,dappdeveloperlib"
    </script>

    <script type="text/javascript" src="https://www.apple.com/metrics/scripts/s_code_h.js"></script>
    <script type="text/javascript">
    s.pageName=AC.Tracking.pageName();
    s.channel="www.us.developer"

    /************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
    var s_code=s.t();if(s_code)document.write(s_code)</script>
    <!-- End SiteCatalyst code version: H.8. -->
    </div>

    <div id="adcHeader" class="hideOnPrint hideInXcode">
        <div id='ssi_Header' class="hideInXcode unified">
            <a id="ssi_LibraryTitle" href='../../../../../navigation/'>Guides and Sample Code</a>
            <a id="ssi_AppleDeveloperConnection" href='https://developer.apple.com/'>Developer</a>
            <div id='ssi_SearchButton' role="button" title="Search">Search</div>
        </div>
        <form id='ssi_SearchMenu' method='get' action='../../../../../search/' accept-charset='utf-8'>
            <label for='adcsearch'>Search Guides and Sample Code</label>
            
            
    
            <input type='search' id='ssi_SearchField' name='q' accesskey='s' results='5' />
        </form>
    </div>

    <header id="header">
        <div id="title" role="banner">
            <h1>Programming with Objective-C</h1>
            <span id="file_links">
                <a id="PDF_link" role="button" tabindex='4' rel="alternate" title="Download PDF"><span id="pdf_icon"></span>PDF</a>
                <a id="Companion_link" role="button" tabindex='3' title="Download Companion File"><span id="companion_icon"></span>Companion File</a>
            </span>
        </div>
        <ul id="headerButtons" class="hideOnPrint" role="toolbar">
            <li id="toc_button" style="display:none">
                <button tabindex="5" id="table_of_contents" class="open" role="checkbox" aria-label="Show Table of Contents"><span class="disclosure"></span>Table of Contents</button>
            </li>
            <li id="jumpto_button" style="display:none" role="navigation"><select tabindex="6" id="jumpTo"><option value="top">Jump To&#133;</option></select></li>
            <li id="downloadSample_button" style="display:none">
                <a id="Sample_link"><button id="Sample_button">Download Sample Code</button></a>
            </li>
        </ul>
    </header>
    <nav id="tocContainer" tabindex="7">
        <ul id="toc" role="tree"></ul>
    </nav>

    <article id="contents" tabindex="0" role="main">
        <div id="pageNavigationLinks_top" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='../EncapsulatingData/EncapsulatingData.html'>Next</a><a class='previousLink' rel='prev' href='../DefiningClasses/DefiningClasses.html'>Previous</a>
        </div>
        <a id="top" name="top"></a>
        <a id="INDEX" href="../index.html" style="display:none;"></a>
        
        <a name="//apple_ref/doc/uid/TP40011210-CH4-SW1" title="Working with Objects"></a><h1 id="pageTitle">Working with Objects</h1><p>The majority of work in an Objective-C application happens as a result of messages being sent back and forth across an ecosystem of objects. Some of these objects are instances of classes provided by Cocoa or Cocoa Touch, some are instances of your own classes.</p><p>The previous chapter described the syntax to define the interface and implementation for a class, including the syntax to implement methods containing the code to be executed in response to a message. This chapter explains how to send such a message to an object, and includes coverage of some of Objective-C’s dynamic features, including dynamic typing and the ability to determine which method should be invoked at runtime.</p><p>Before an object can be used, it must be created properly using a combination of memory allocation for its properties and any necessary initialization of its internal values. This chapter describes how to nest the method calls to allocate and initialize an object in order to ensure that it is configured correctly.</p><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW2" title="Objects Send and Receive Messages"></a><h2 class="jump">Objects Send and Receive Messages</h2><p>Although there are several different ways to send messages between objects in Objective-C, by far the most common is the basic syntax that uses square brackets, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    [someObject doSomething];<span></span></pre></td></tr></table></div><p>The reference on the left, <code>someObject</code> in this case, is the receiver of the message. The message on the right, <code>doSomething</code>, is the name of the method to call on that receiver. In other words, when the above line of code is executed, <code>someObject</code> will be sent the <code>doSomething</code> message.</p><p>The previous chapter described how to create the interface for a class, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@interface XYZPerson : NSObject<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)sayHello;<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><p>and how to create the implementation of that class, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@implementation XYZPerson<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)sayHello {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"Hello, world!");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH4-SW10" title="Note"></a><p><strong>Note:</strong>&nbsp;This example uses an Objective-C string literal, <code>@"Hello, world!"</code>. Strings are one of several class types in Objective-C that allow a shorthand literal syntax for their creation. Specifying <code>@"Hello, world!"</code> is conceptually equivalent to saying “An Objective-C string object that represents the string <em>Hello, world!</em>.” </p><p>Literals and object creation are explained further in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH4-SW7" data-renderer-version="1">Objects Are Created Dynamically</a></span>, later in this chapter.</p><p></p></aside></div><p>Assuming you’ve got hold of an <code>XYZPerson</code> object, you could send it the <code>sayHello</code> message like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    [somePerson sayHello];<span></span></pre></td></tr></table></div><p>Sending an Objective-C message is conceptually very much like calling a C function. <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH4-SW4" data-renderer-version="1">Figure 2-1</a></span> shows the effective program flow for the <code>sayHello</code> message.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH4-SW4" title="Figure 2-1Basic messaging program flow"></a><figcaption><strong class="caption_number">Figure 2-1</strong>&nbsp;&nbsp;Basic messaging program flow</figcaption><img src="../Art/programflow1.png" alt="" width="426" height="310"></figure><p>In order to specify the receiver of a message, it’s important to understand how pointers are used to refer to objects in Objective-C.</p><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW6" title="Use Pointers to Keep Track of Objects"></a><h3 class="jump">Use Pointers to Keep Track of Objects</h3><p>C and Objective-C use variables to keep track of values, just like most other programming languages.</p><p>There are a number of basic scalar variable types defined in standard C, including integers, floating-point numbers and characters, which are declared and assigned values like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    int someInteger = 42;<span></span></pre></td></tr><tr><td scope="row"><pre>    float someFloatingPointNumber = 3.14f;<span></span></pre></td></tr></table></div><p>Local variables, which are variables declared within a method or function, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (void)myMethod {<span></span></pre></td></tr><tr><td scope="row"><pre>    int someInteger = 42;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>are limited in scope to the method in which they are defined.</p><p>In this example, <code>someInteger</code> is declared as a local variable inside <code>myMethod</code>; once execution reaches the closing brace of the method, <code>someInteger</code> will no longer be accessible. When a local scalar variable (like an <code>int</code> or a <code>float</code>) goes away, the value disappears too.</p><p>Objective-C objects, by contrast, are allocated slightly differently. Objects normally have a longer life than the simple scope of a method call. In particular, an object often needs to stay alive longer than the original variable that was created to keep track of it, so an object’s memory is allocated and deallocated dynamically.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH4-SW20" title="Note"></a><p><strong>Note:</strong>&nbsp;If you’re used to using terms like the <em class="newTerm">stack</em> and the <em class="newTerm">heap</em>, a local variable is allocated on the stack, while objects are allocated on the heap.</p><p></p></aside></div><p>This requires you to use C pointers (which hold memory addresses) to keep track of their location in memory, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (void)myMethod {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *myString = // get a string from somewhere...<span></span></pre></td></tr><tr><td scope="row"><pre>    [...]<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Although the scope of the pointer variable <code>myString</code> (the asterisk indicates it’s a pointer) is limited to the scope of <code>myMethod</code>, the actual string object that it points to in memory may have a longer life outside that scope. It might already exist, or you might need to pass the object around in additional method calls, for example.</p></section><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW13" title="You Can Pass Objects for Method Parameters"></a><h3 class="jump">You Can Pass Objects for Method Parameters</h3><p>If you need to pass along an object when sending a message, you supply an object pointer for one of the method parameters. The previous chapter described the syntax to declare a method with a single parameter:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (void)someMethodWithValue:(SomeType)value;<span></span></pre></td></tr></table></div><p>The syntax to declare a method that takes a string object, therefore, looks like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (void)saySomething:(NSString *)greeting;<span></span></pre></td></tr></table></div><p>You might implement the <code>saySomething:</code> method like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (void)saySomething:(NSString *)greeting {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"%@", greeting);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The <code>greeting</code> pointer behaves like a local variable and is limited in scope just to the <code>saySomething:</code> method, even though the actual string object that it points to existed prior to the method being called, and will continue to exist after the method completes.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH4-SW23" title="Note"></a><p><strong>Note:</strong>&nbsp;<code>NSLog()</code> uses format specifiers to indicate substitution tokens, just like the C standard library <code>printf()</code> function. The string logged to the console is the result of modifying the format string (the first argument) by inserting the provided values (the remaining arguments).</p><p>There is one additional substitution token available in Objective-C, <code>%@</code>, used to denote an object. At runtime, this specifier will be substituted with the result of calling either the <code>descriptionWithLocale:</code> method (if it exists) or the <code>description</code> method on the provided object. The <code>description</code> method is implemented by <code>NSObject</code> to return the class and memory address of the object, but many Cocoa and Cocoa Touch classes override it to provide more useful information. In the case of <code>NSString</code>, the <code>description</code> method simply returns the string of characters that it represents.</p><p>For more information about the available format specifiers for use with <code>NSLog()</code> and the <code>NSString</code> class, see <span class="content_text"><a href="../../Strings/Articles/formatSpecifiers.html#//apple_ref/doc/uid/TP40004265" data-renderer-version="1" target="_self">String Format Specifiers</a></span>.</p><p></p></aside></div></section><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW3" title="Methods Can Return Values"></a><h3 class="jump">Methods Can Return Values</h3><p>As well as passing values through method parameters, it’s possible for a method to return a value. Each method shown in this chapter so far has a return type of <code>void</code>. The C <code>void</code> keyword means a method doesn’t return anything.</p><p>Specifying a return type of <code>int</code> means that the method returns a scalar integer value:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (int)magicNumber;<span></span></pre></td></tr></table></div><p>The implementation of the method uses a C <code>return</code> statement to indicate the value that should be passed back after the method has finished executing, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (int)magicNumber {<span></span></pre></td></tr><tr><td scope="row"><pre>    return 42;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>It’s perfectly acceptable to ignore the fact that a method returns a value. In this case the <code>magicNumber</code> method doesn’t do anything useful other than return a value, but there’s nothing wrong with calling the method like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    [someObject magicNumber];<span></span></pre></td></tr></table></div><p>If you do need to keep track of the returned value, you can declare a variable and assign it to the result of the method call, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    int interestingNumber = [someObject magicNumber];<span></span></pre></td></tr></table></div><p>You can return objects from methods in just the same way. The <code>NSString</code> class, for example, offers an <code>uppercaseString</code> method:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (NSString *)uppercaseString;<span></span></pre></td></tr></table></div><p>It’s used in the same way as a method returning a scalar value, although you need to use a pointer to keep track of the result:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSString *testString = @"Hello, world!";<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *revisedString = [testString uppercaseString];<span></span></pre></td></tr></table></div><p>When this method call returns, <code>revisedString</code> will point to an <code>NSString</code> object representing the characters <code>HELLO WORLD!</code>.</p><p>Remember that when implementing a method to return an object, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (NSString *)magicString {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *stringToReturn = // create an interesting string...<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return stringToReturn;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>the string object continues to exist when it is passed as a return value even though the <code>stringToReturn</code> pointer goes out of scope.</p><p>There are some memory management considerations in this situation: a returned object (created on the heap) needs to exist long enough for it to be used by the original caller of the method, but not in perpetuity because that would create a memory leak. For the most part, the Automatic Reference Counting (ARC) feature of the Objective-C compiler takes care of these considerations for you.</p></section><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW5" title="Objects Can Send Messages to Themselves"></a><h3 class="jump">Objects Can Send Messages to Themselves</h3><p>Whenever you’re writing a method implementation, you have access to an important hidden value, <code>self</code>. Conceptually, <code>self</code> is a way to refer to “the object that’s received this message.” It’s a pointer, just like the <code>greeting</code> value above, and can be used to call a method on the current receiving object.</p><p>You might decide to refactor the <code>XYZPerson</code> implementation by modifying the <code>sayHello</code> method to use the <code>saySomething:</code> method shown above, thereby moving the <code>NSLog()</code> call to a separate method. This would mean you could add further methods, like <code>sayGoodbye</code>, that would each call through to the <code>saySomething:</code> method to handle the actual greeting process. If you later wanted to display each greeting in a text field in the user interface, you’d only need to modify the <code>saySomething:</code> method rather than having to go through and adjust each greeting method individually.</p><p>The new implementation using <code>self</code> to call a message on the current object would look like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@implementation XYZPerson<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)sayHello {<span></span></pre></td></tr><tr><td scope="row"><pre>    [self saySomething:@"Hello, world!"];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)saySomething:(NSString *)greeting {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"%@", greeting);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><p>If you sent an <code>XYZPerson</code> object the <code>sayHello</code> message for this updated implementation, the effective program flow would be as shown in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH4-SW8" data-renderer-version="1">Figure 2-2</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH4-SW8" title="Figure 2-2Program flow when messaging self"></a><figcaption><strong class="caption_number">Figure 2-2</strong>&nbsp;&nbsp;Program flow when messaging self</figcaption><img src="../Art/programflow2.png" alt="" width="426" height="370"></figure></section><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW11" title="Objects Can Call Methods Implemented by Their Superclasses"></a><h3 class="jump">Objects Can Call Methods Implemented by Their Superclasses</h3><p>There’s another important keyword available to you in Objective-C, called <code>super</code>. Sending a message to <code>super</code> is a way to call through to a method implementation defined by a superclass further up the inheritance chain. The most common use of <code>super</code> is when overriding a method.</p><p>Let’s say you want to create a new type of person class, a “shouting person” class, where every greeting is displayed using capital letters. You could duplicate the entire <code>XYZPerson</code> class and modify each string in each method to be uppercase, but the simplest way would be to create a new class that inherits from <code>XYZPerson</code>, and just override the <code>saySomething:</code> method so that it displays the greeting in uppercase, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@interface XYZShoutingPerson : XYZPerson<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><div class="codesample clear"><table><tr><td scope="row"><pre>@implementation XYZShoutingPerson<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)saySomething:(NSString *)greeting {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *uppercaseGreeting = [greeting uppercaseString];<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"%@", uppercaseGreeting);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><p>This example declares an extra string pointer, <code>uppercaseGreeting</code> and assigns it the value returned from sending the original <code>greeting</code> object the <code>uppercaseString</code> message. As you saw earlier, this will be a new string object built by converting each character in the original string to uppercase.</p><p>Because <code>sayHello</code> is implemented by <code>XYZPerson</code>, and <code>XYZShoutingPerson</code> is set to inherit from <code>XYZPerson</code>, you can call <code>sayHello</code> on an <code>XYZShoutingPerson</code> object as well. When you call <code>sayHello</code> on an <code>XYZShoutingPerson</code>, the call to <code>[self saySomething:...]</code> will use the <em>overridden</em> implementation and display the greeting as uppercase, resulting in the effective program flow shown in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH4-SW9" data-renderer-version="1">Figure 2-3</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH4-SW9" title="Figure 2-3Program flow for an overridden method"></a><figcaption><strong class="caption_number">Figure 2-3</strong>&nbsp;&nbsp;Program flow for an overridden method</figcaption><img src="../Art/programflow3.png" alt="" width="537" height="519"></figure><p>The new implementation isn’t ideal, however, because if you did decide later to modify the <code>XYZPerson</code> implementation of <code>saySomething:</code> to display the greeting in a user interface element rather than through <code>NSLog()</code>, you’d need to modify the <code>XYZShoutingPerson</code> implementation as well.</p><p>A better idea would be to change the <code>XYZShoutingPerson</code> version of <code>saySomething:</code> to call through to the superclass (<code>XYZPerson</code>) implementation to handle the actual greeting:</p><div class="codesample clear"><table><tr><td scope="row"><pre>@implementation XYZShoutingPerson<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)saySomething:(NSString *)greeting {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *uppercaseGreeting = [greeting uppercaseString];<span></span></pre></td></tr><tr><td scope="row"><pre>    [super saySomething:uppercaseGreeting];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><p>The effective program flow that now results from sending an <code>XYZShoutingPerson</code> object the <code>sayHello</code> message is shown in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH4-SW12" data-renderer-version="1">Figure 2-4</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH4-SW12" title="Figure 2-4Program flow when messaging super"></a><figcaption><strong class="caption_number">Figure 2-4</strong>&nbsp;&nbsp;Program flow when messaging super</figcaption><img src="../Art/programflow4.png" alt="" width="532" height="519"></figure></section></section><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW7" title="Objects Are Created Dynamically"></a><h2 class="jump">Objects Are Created Dynamically</h2><p>As described earlier in this chapter, memory is allocated dynamically for an Objective-C object. The first step in creating an object is to make sure enough memory is allocated not only for the properties defined by an object’s class, but also the properties defined on each of the superclasses in its inheritance chain.</p><p>The <code>NSObject</code> root class provides a class method, <code>alloc</code>, which handles this process for you:</p><div class="codesample clear"><table><tr><td scope="row"><pre>+ (id)alloc;<span></span></pre></td></tr></table></div><p>Notice that the return type of this method is <code>id</code>. This is a special keyword used in Objective-C to mean “some kind of object.” It is a pointer to an object, like <code>(NSObject *)</code>, but is special in that it doesn’t use an asterisk. It’s described in more detail later in this chapter, in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH4-SW18" data-renderer-version="1">Objective-C Is a Dynamic Language</a></span>.</p><p>The <code>alloc</code> method has one other important task, which is to clear out the memory allocated for the object’s properties by setting them to zero. This avoids the usual problem of memory containing garbage from whatever was stored before, but is not enough to initialize an object completely.</p><p>You need to combine a call to <code>alloc</code> with a call to <code>init</code>, another <code>NSObject</code> method:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (id)init;<span></span></pre></td></tr></table></div><p>The <code>init</code> method is used by a class to make sure its properties have suitable initial values at creation, and is covered in more detail in the next chapter.</p><p>Note that <code>init</code> also returns an <code>id</code>.</p><p>If one method returns an object pointer, it’s possible to nest the call to that method as the receiver in a call to another method, thereby combining multiple message calls in one statement. The correct way to allocate and initialize an object is to nest the <code>alloc</code> call <em>inside</em> the call to <code>init</code>, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSObject *newObject = [[NSObject alloc] init];<span></span></pre></td></tr></table></div><p>This example sets the <code>newObject</code> variable to point to a newly created <code>NSObject</code> instance.</p><p>The innermost call is carried out first, so the <code>NSObject</code> class is sent the <code>alloc</code> method, which returns a newly allocated <code>NSObject</code> instance. This returned object is then used as the receiver of the <code>init</code> message, which itself returns the object back to be assigned to the <code>newObject</code> pointer, as shown in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40011210-CH4-SW14" data-renderer-version="1">Figure 2-5</a></span>.</p><figure class="figure"><a name="//apple_ref/doc/uid/TP40011210-CH4-SW14" title="Figure 2-5Nesting the alloc and init message"></a><figcaption><strong class="caption_number">Figure 2-5</strong>&nbsp;&nbsp;Nesting the alloc and init message</figcaption><img src="../Art/nestedallocinit.png" alt="" width="301" height="197"></figure><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH4-SW15" title="Note"></a><p><strong>Note:</strong>&nbsp;It’s possible for <code>init</code> to return a different object than was created by <code>alloc</code>, so it’s best practice to nest the calls as shown.</p><p>Never initialize an object without reassigning any pointer to that object. As an example, don’t do this:</p><p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSObject *someObject = [NSObject alloc];<span></span></pre></td></tr><tr><td scope="row"><pre>    [someObject init];<span></span></pre></td></tr></table></div>If the call to <code>init</code> returns some other object, you’ll be left with a pointer to the object that was originally allocated but never initialized.</p><p></p></aside></div><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW16" title="Initializer Methods Can Take Arguments"></a><h3 class="jump">Initializer Methods Can Take Arguments</h3><p>Some objects need to be initialized with required values. An <code>NSNumber</code> object, for example, must be created with the numeric value it needs to represent.</p><p>The <code>NSNumber</code> class defines several initializers, including:</p><div class="codesample clear"><table><tr><td scope="row"><pre>- (id)initWithBool:(BOOL)value;<span></span></pre></td></tr><tr><td scope="row"><pre>- (id)initWithFloat:(float)value;<span></span></pre></td></tr><tr><td scope="row"><pre>- (id)initWithInt:(int)value;<span></span></pre></td></tr><tr><td scope="row"><pre>- (id)initWithLong:(long)value;<span></span></pre></td></tr></table></div><p>Initialization methods with arguments are called in just the same way as plain <code>init</code> methods—an <code>NSNumber</code> object is allocated and initialized like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSNumber *magicNumber = [[NSNumber alloc] initWithInt:42];<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW17" title="Class Factory Methods Are an Alternative to Allocation and Initialization"></a><h3 class="jump">Class Factory Methods Are an Alternative to Allocation and Initialization</h3><p>As mentioned in the previous chapter, a class can also define factory methods. Factory methods offer an alternative to the traditional <code>alloc] init]</code> process, without the need to nest two methods.</p><p>The <code>NSNumber</code> class defines several class factory methods to match its initializers, including:</p><div class="codesample clear"><table><tr><td scope="row"><pre>+ (NSNumber *)numberWithBool:(BOOL)value;<span></span></pre></td></tr><tr><td scope="row"><pre>+ (NSNumber *)numberWithFloat:(float)value;<span></span></pre></td></tr><tr><td scope="row"><pre>+ (NSNumber *)numberWithInt:(int)value;<span></span></pre></td></tr><tr><td scope="row"><pre>+ (NSNumber *)numberWithLong:(long)value;<span></span></pre></td></tr></table></div><p>A factory method is used like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSNumber *magicNumber = [NSNumber numberWithInt:42];<span></span></pre></td></tr></table></div><p>This is effectively the same as the previous example using <code>alloc] initWithInt:]</code>. Class factory methods usually just call straight through to <code>alloc</code> and the relevant <code>init</code> method, and are provided for convenience.</p></section><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW27" title="Use new to Create an Object If No Arguments Are Needed for Initialization"></a><h3 class="jump">Use new to Create an Object If No Arguments Are Needed for Initialization</h3><p>It’s also possible to create an instance of a class using the <code>new</code> class method. This method is provided by <code>NSObject</code> and doesn’t need to be overridden in your own subclasses. </p><p>It’s effectively the same as calling <code>alloc</code> and <code>init</code> with no arguments:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    XYZObject *object = [XYZObject new];<span></span></pre></td></tr><tr><td scope="row"><pre>    // is effectively the same as:<span></span></pre></td></tr><tr><td scope="row"><pre>    XYZObject *object = [[XYZObject alloc] init];<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW19" title="Literals Offer a Concise Object-Creation Syntax"></a><h3 class="jump">Literals Offer a Concise Object-Creation Syntax</h3><p>Some classes allow you to use a more concise, <em class="newTerm">literal</em> syntax to create instances.</p><p>You can create an <code>NSString</code> instance, for example, using a special literal notation, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSString *someString = @"Hello, World!";<span></span></pre></td></tr></table></div><p>This is effectively the same as allocating and initializing an <code>NSString</code> or using one of its class factory methods:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSString *someString = [NSString stringWithCString:"Hello, World!"<span></span></pre></td></tr><tr><td scope="row"><pre>                                              encoding:NSUTF8StringEncoding];<span></span></pre></td></tr></table></div><p>The <code>NSNumber</code> class also allows a variety of literals:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSNumber *myBOOL = @YES;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSNumber *myFloat = @3.14f;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSNumber *myInt = @42;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSNumber *myLong = @42L;<span></span></pre></td></tr></table></div><p>Again, each of these examples is effectively the same as using the relevant initializer or a class factory method.</p><p>You can also create an <code>NSNumber</code> using a boxed expression, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSNumber *myInt = @(84 / 2);<span></span></pre></td></tr></table></div><p>In this case, the expression is evaluated, and an <code>NSNumber</code> instance created with the result.</p><p>Objective-C also supports literals to create immutable <code>NSArray</code> and <code>NSDictionary</code> objects; these are discussed further in <span class="content_text"><a href="../FoundationTypesandCollections/FoundationTypesandCollections.html#//apple_ref/doc/uid/TP40011210-CH7-SW1" data-renderer-version="1">Values and Collections</a></span>.</p></section></section><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW18" title="Objective-C Is a Dynamic Language"></a><h2 class="jump">Objective-C Is a Dynamic Language</h2><p>As mentioned earlier, you need to use a pointer to keep track of an object in memory. Because of Objective-C’s dynamic nature, it doesn’t matter what specific class type you use for that pointer—the correct method will always be called on the relevant object when you send it a message.</p><p>The <code>id</code> type defines a generic object pointer. It’s possible to use <code>id</code> when declaring a variable, but you lose <em>compile</em>-time information about the object.</p><p>Consider the following code:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    id someObject = @"Hello, World!";<span></span></pre></td></tr><tr><td scope="row"><pre>    [someObject removeAllObjects];<span></span></pre></td></tr></table></div><p>In this case, <code>someObject</code> will point to an <code>NSString</code> instance, but the compiler knows nothing about that instance beyond the fact that it’s some kind of object. The <code>removeAllObjects</code> message is defined by some Cocoa or Cocoa Touch objects (such as <code>NSMutableArray</code>) so the compiler doesn’t complain, even though this code would generate an exception at runtime because an <code>NSString</code> object can’t respond to <code>removeAllObjects</code>.</p><p>Rewriting the code to use a static type:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    NSString *someObject = @"Hello, World!";<span></span></pre></td></tr><tr><td scope="row"><pre>    [someObject removeAllObjects];<span></span></pre></td></tr></table></div><p>means that the compiler will now generate an error because <code>removeAllObjects</code> is not declared in any public <code>NSString</code> interface that it knows about.</p><p>Because the class of an object is determined at runtime, it makes no difference what type you assign a variable when creating or working with an instance. To use the <code>XYZPerson</code> and <code>XYZShoutingPerson</code> classes described earlier in this chapter, you might use the following code:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    XYZPerson *firstPerson = [[XYZPerson alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    XYZPerson *secondPerson = [[XYZShoutingPerson alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    [firstPerson sayHello];<span></span></pre></td></tr><tr><td scope="row"><pre>    [secondPerson sayHello];<span></span></pre></td></tr></table></div><p>Although both <code>firstPerson</code> and <code>secondPerson</code> are statically typed as <code>XYZPerson</code> objects, <code>secondPerson</code> will point, at <em>runtime</em>, to an <code>XYZShoutingPerson</code> object. When the <code>sayHello</code> method is called on each object, the correct implementations will be used; for <code>secondPerson</code>, this means the <code>XYZShoutingPerson</code> version.</p><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW21" title="Determining Equality of Objects"></a><h3 class="jump">Determining Equality of Objects</h3><p>If you need to determine whether one object is the same as another object, it’s important to remember that you’re working with pointers.</p><p>The standard C equality operator <code>==</code> is used to test equality between the values of two variables, like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    if (someInteger == 42) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // someInteger has the value 42<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>When dealing with objects, the <em>==</em> operator is used to test whether two separate pointers are pointing to the same object:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    if (firstPerson == secondPerson) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // firstPerson is the same object as secondPerson<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>If you need to test whether two objects represent the same data, you need to call a method like <code>isEqual:</code>, available from <code>NSObject</code>:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    if ([firstPerson isEqual:secondPerson]) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // firstPerson is identical to secondPerson<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>If you need to compare whether one object represents a greater or lesser value than another object, you can’t use the standard C comparison operators <code>&gt;</code> and <code>&lt;</code>. Instead, the basic Foundation types, like <code>NSNumber</code>, <code>NSString</code> and <code>NSDate</code>, provide a <code>compare:</code> method:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    if ([someDate compare:anotherDate] == NSOrderedAscending) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // someDate is earlier than anotherDate<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW22" title="Working with nil"></a><h3 class="jump">Working with nil</h3><p>It’s always a good idea to initialize scalar variables at the time you declare them, otherwise their initial values will contain garbage from the previous stack contents:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    BOOL success = NO;<span></span></pre></td></tr><tr><td scope="row"><pre>    int magicNumber = 42;<span></span></pre></td></tr></table></div><p>This isn’t necessary for object pointers, because the compiler will automatically set the variable to <code>nil</code> if you don’t specify any other initial value:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    XYZPerson *somePerson;<span></span></pre></td></tr><tr><td scope="row"><pre>    // somePerson is automatically set to nil<span></span></pre></td></tr></table></div><p>A <code>nil</code> value is the safest way to initialize an object pointer if you don’t have another value to use, because it’s perfectly acceptable in Objective-C to send a message to <code>nil</code>. If you do send a message to <code>nil</code>, obviously nothing happens.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH4-SW28" title="Note"></a><p><strong>Note:</strong>&nbsp;If you expect a return value from a message sent to <code>nil</code>, the return value will be <code>nil</code> for object return types, <code>0</code> for numeric types, and <code><!--a  -->NO<!--/a--></code> for <code>BOOL</code> types. Returned structures have all members initialized to zero.</p><p></p></aside></div><p>If you need to check to make sure an object is not <code>nil</code> (that a variable points to an object in memory), you can either use the standard C inequality operator:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    if (somePerson != nil) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // somePerson points to an object<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>or simply supply the variable:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    if (somePerson) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // somePerson points to an object<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>If the <code>somePerson</code> variable is <code>nil</code>, its logical value is <code>0</code> (false). If it has an address, it’s not zero, so evaluates as true.</p><p>Similarly, if you need to check for a <code>nil</code> variable, you can either use the equality operator:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    if (somePerson == nil) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // somePerson does not point to an object<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>or just use the C logical negation operator:</p><div class="codesample clear"><table><tr><td scope="row"><pre>    if (!somePerson) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // somePerson does not point to an object<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div></section></section><section><a name="//apple_ref/doc/uid/TP40011210-CH4-SW24" title="Exercises"></a><h2 class="jump">Exercises</h2><ol class="ol"><li class="li"><p>Open the <code>main.m</code> file in your project from the exercises at the end of the last chapter and find the <code>main()</code> function. As with any executable written in C, this function represents the starting point for your application.</p><p>Create a new <code>XYZPerson</code> instance using <code>alloc</code> and <code>init</code>, and then call the <code>sayHello</code> method.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH4-SW25" title="Note"></a><p><strong>Note:</strong>&nbsp;If the compiler doesn’t prompt you automatically, you will need to import the header file (containing the <code>XYZPerson</code> interface) at the top of <code>main.m</code>.</p><p></p></aside></div></li><li class="li"><p>Implement the <code>saySomething:</code> method shown earlier in this chapter, and rewrite the <code>sayHello</code> method to use it. Add a variety of other greetings and call each of them on the instance you created above.</p></li><li class="li"><p>Create new class files for the <code>XYZShoutingPerson</code> class, set to inherit from <code>XYZPerson</code>.</p><p>Override the <code>saySomething:</code> method to display the uppercase greeting, and test the behavior on an <code>XYZShoutingPerson</code> instance.</p></li><li class="li"><p>Implement the <code>XYZPerson</code> class <code>person</code> factory method you declared in the previous chapter, to return a correctly allocated and initialized instance of the <code>XYZPerson</code> class, then use the method in <code>main()</code> instead of your nested <code>alloc</code> and <code>init</code>.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40011210-CH4-SW26" title="Tip"></a><p><strong>Tip:</strong>&nbsp;Rather than using <code>[[XYZPerson alloc] init]</code> in the class factory method, instead try using <code>[[self alloc] init]</code>.</p><p>Using <code>self</code> in a class factory method means that you’re referring to the class itself.</p><p>This means that you don’t have to override the <code>person</code> method in the <code>XYZShoutingPerson</code> implementation to create the correct instance. Test this by checking that:</p><p><div class="codesample clear"><table><tr><td scope="row"><pre>    XYZShoutingPerson *shoutingPerson = [XYZShoutingPerson person];<span></span></pre></td></tr></table></div>creates the correct type of object.</p><p></p></aside></div></li><li class="li"><p>Create a new local <code>XYZPerson</code> pointer, but don’t include any value assignment. </p><p>Use a branch (<code>if</code> statement) to check whether the variable is automatically assigned as <code>nil</code>.</p></li></ol></section>
        <div id="pageNavigationLinks_bottom" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='../EncapsulatingData/EncapsulatingData.html'>Next</a><a class='previousLink' rel='prev' href='../DefiningClasses/DefiningClasses.html'>Previous</a>
        </div><br/>
        <div class="copyright"><br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> Copyright &#x00a9; 2014 Apple Inc. All Rights Reserved. <a href="http://www.apple.com/legal/internet-services/terms/site.html" target="_blank">Terms of Use</a>   |  <a href="http://www.apple.com/privacy/" target="_blank">Privacy Policy</a>  |  Updated: 2014-09-17</p></div></div>

        <div id="pediaWindow">
            <div id="pediaHeader"></div>
            <div id="pediaBody"></div>
        </div>
    </article>

    <div id="blackout">
    <div id="preload"></div>
</div>
<div id="leave_feedback" class="button" role="button" tabindex="0">Feedback</div>
<div id="modal" aria-hidden="true">
    <div id="closebox" tabindex="0" aria-label="Close feedback form" role="button"></div>
    <div id="sending" class="hidden">
        <h2 tabindex="0">Sending feedback&hellip;</h2>
        <div id="sending_img"></div>
    </div>
    <div id="error" class="hidden">
        <h2 tabindex="0">We&rsquo;re sorry, an error has occurred.</h2>
        <p>Please try submitting your feedback later.</p>
        <div id="error_icon"></div>
    </div>
    <div id="success" class="hidden">
        <h2 tabindex="0">Thank you for providing feedback!</h2>
        <p>Your input helps improve our developer documentation.</p>
        <div id="thank_you_icon"></div>
    </div>
    
    <form id="feedback" action="#" method="post">
        <div class="left-leaf">
            <h2 id="helpful_title" data-asterisk="a1" tabindex="0">How helpful is this document?</h2>     
            <sup id="a1" class="asterisk" aria-hidden="true">*</sup>

            <div id="star_group" role="radiogroup" aria-required="true">
                <label> 
                    <input class="radio" type="radio" name="helped" value="1" /> 
                    Very helpful
                </label>
                <label> 
                    <input class="radio" type="radio" name="helped" value="2" /> 
                    Somewhat helpful
                </label>
                <label>
                    <input class="radio" type="radio" name="helped" value="3" /> 
                    Not helpful
                </label>
            </div>
        </div>
        <div class="right-leaf">
            <h2>How can we improve this document?</h2>
            <div id="improve" class="checkboxes">
                <label>
                    <input type="checkbox" name="typo" /> 
                    Fix typos or links
                </label>
                <label>
                    <input type="checkbox" name="infoIncorrect" /> 
                    Fix incorrect information
                </label>
                <label>
                    <input type="checkbox" name="needs_examples" /> 
                    Add or update code samples
                </label>
                <label>
                    <input type="checkbox" name="needs_art" /> 
                    Add or update illustrations
                </label>
                <label>
                    <input type="checkbox" name="missingInfo" /> 
                    Add information about...
                </label>
            </div>
        </div>

        <textarea id="comment" name="problem" cols="70" rows="8" placeholder="Please tell us more about your experience with this document" data-asterisk="a2" required></textarea>
        <sup id="a2" class="asterisk" aria-hidden="true">*</sup>

        <p class="fineprint">
            <em aria-hidden="true"><span>*</span> Required information</em>
        </p> 

        <input id="submit" type="button" value="Send" />

        <section id="legal">
            <p>
                To submit a product bug or enhancement request, please visit the 
                <a href="https://developer.apple.com/bugreporter/" target="_blank">Bug Reporter</a> 
                page.
            </p>
            <p>
                Please read <a href="http://www.apple.com/legal/policies/ideas.html" target="_blank">Apple's Unsolicited Idea Submission Policy</a> 
                before you send us your feedback.
            </p> 
        </section>
    </form>
</div>

    
    <script charset="utf-8" src="../../../../../Resources/1260/JavaScript/lib/prototype.js"></script>
    <script src="../../../../../Resources/1260/JavaScript/library.js"></script>
    <script src="../../../../../Resources/1260/JavaScript/feedback.js"></script>
</body>
</html>
