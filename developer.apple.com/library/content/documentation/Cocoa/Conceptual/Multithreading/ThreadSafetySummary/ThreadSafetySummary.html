<!DOCTYPE html>
<html lang="en">
<head>
    <title>Thread Safety Summary</title>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta charset="utf-8">
    <meta id="book-resource-type" name="book-resource-type" content="Guide">
    <meta scheme="apple_ref" id="identifier" name="identifier" content="//apple_ref/doc/uid/10000057i">
    <meta id="document-version" name="document-version" content="5.6.3">
    <meta id="build" name="build" content="ded95564c405529dbbbe590063edd114" />
    <meta id="chapterId" name="chapterId" content="10000057i-CH12">
    <meta id="date" name="date" content="2014-07-15">
    <meta id="description" name="description" content="Explains how to use threads in Cocoa applications.">
    <meta id="book-title" name="book-title" content="Threading Programming Guide">
    <meta id="book-root" name="book-root" content="../">
    <meta id="book-json" name="book-json" content="../book.json">
    <meta id="devcenter" name="devcenter" content="Mac Dev Center">
    <meta id="devcenter-url" name="devcenter-url" content="http://developer.apple.com/devcenter/mac">
    <meta id="reflib" name="reflib" content="Guides and Sample Code">
    <meta id="book-assignments" name="book-assignments" content="{Type/Guide}, {Topic/Performance}">
    
    
    <meta id="copyright" name="copyright" content="Copyright 2017 Apple Inc. All Rights Reserved.">
    <meta id="xcode-display" name="xcode-display" content="render">
    <meta id="IndexTitle" name="IndexTitle" content="Threading Programming Guide: Thread Safety Summary">
    <meta id="resources-uri" name="resources-uri" content="../../../../../Resources/1260">
    <link id="book-index-page" rel="Start" title="Threading Programming Guide" type="text/html" href="../index.html">
    <link id="next-page" rel="Next" type="text/html" href="../Glossary/Glossary.html">
    <link id="previous-page" rel="Prev" type="text/html" href="../ThreadSafety/ThreadSafety.html">
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1260/CSS/screen.css">
    
    <!-- xcode_css -->
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1260/CSS/feedback.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta id="platforms" name="platforms" content="">
</head>    
<body><a name="//apple_ref/doc/uid/10000057i-CH12" title="Thread Safety Summary"></a>
    <div id="_omniture_top">
    <!-- SiteCatalyst code version: H.8. Copyright 1997-2006 Omniture, Inc. -->
    <script type="text/javascript">
    /* RSID: */
    var s_account="appleglobal,appleusdeveloper,dappdeveloperlib"
    </script>

    <script type="text/javascript" src="https://www.apple.com/metrics/scripts/s_code_h.js"></script>
    <script type="text/javascript">
    s.pageName=AC.Tracking.pageName();
    s.channel="www.us.developer"

    /************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
    var s_code=s.t();if(s_code)document.write(s_code)</script>
    <!-- End SiteCatalyst code version: H.8. -->
    </div>

    <div id="adcHeader" class="hideOnPrint hideInXcode">
        <div id='ssi_Header' class="hideInXcode unified">
            <a id="ssi_LibraryTitle" href='../../../../../navigation/'>Guides and Sample Code</a>
            <a id="ssi_AppleDeveloperConnection" href='https://developer.apple.com/'>Developer</a>
            <div id='ssi_SearchButton' role="button" title="Search">Search</div>
        </div>
        <form id='ssi_SearchMenu' method='get' action='../../../../../search/' accept-charset='utf-8'>
            <label for='adcsearch'>Search Guides and Sample Code</label>
            
            
    
            <input type='search' id='ssi_SearchField' name='q' accesskey='s' results='5' />
        </form>
    </div>

    <header id="header">
        <div id="title" role="banner">
            <h1>Threading Programming Guide</h1>
            <span id="file_links">
                <a id="PDF_link" role="button" tabindex='4' rel="alternate" title="Download PDF"><span id="pdf_icon"></span>PDF</a>
                <a id="Companion_link" role="button" tabindex='3' title="Download Companion File"><span id="companion_icon"></span>Companion File</a>
            </span>
        </div>
        <ul id="headerButtons" class="hideOnPrint" role="toolbar">
            <li id="toc_button" style="display:none">
                <button tabindex="5" id="table_of_contents" class="open" role="checkbox" aria-label="Show Table of Contents"><span class="disclosure"></span>Table of Contents</button>
            </li>
            <li id="jumpto_button" style="display:none" role="navigation"><select tabindex="6" id="jumpTo"><option value="top">Jump To&#133;</option></select></li>
            <li id="downloadSample_button" style="display:none">
                <a id="Sample_link"><button id="Sample_button">Download Sample Code</button></a>
            </li>
        </ul>
    </header>
    <nav id="tocContainer" tabindex="7">
        <ul id="toc" role="tree"></ul>
    </nav>

    <article id="contents" tabindex="0" role="main">
        <div id="pageNavigationLinks_top" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='../Glossary/Glossary.html'>Next</a><a class='previousLink' rel='prev' href='../ThreadSafety/ThreadSafety.html'>Previous</a>
        </div>
        <a id="top" name="top"></a>
        <a id="INDEX" href="../index.html" style="display:none;"></a>
        
        <a name="//apple_ref/doc/uid/10000057i-CH12-SW1" title="Thread Safety Summary"></a><h1 id="pageTitle">Thread Safety Summary</h1><p>This appendix describes the high-level thread safety of some key frameworks in OS X and iOS. The information in this appendix is subject to change. </p><section><a name="//apple_ref/doc/uid/10000057i-CH12-SW4" title="Cocoa"></a><h2 class="jump">Cocoa</h2><p>Guidelines for using Cocoa from multiple threads include the following:</p><ul class="ul"><li class="li"><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_36"></a><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_37"></a>Immutable objects are generally thread-safe. Once you create them, you can safely pass these objects to and from threads. On the other hand, mutable objects are generally not thread-safe. To use mutable objects in a threaded application, the application must synchronize appropriately. For more information, see <span class="content_text"><a href="#//apple_ref/doc/uid/20000736-126010" data-renderer-version="1">Mutable Versus Immutable</a></span>. </p></li><li class="li"><p>Many objects deemed “thread-unsafe” are only unsafe to use from multiple threads. Many of these objects can be used from any thread as long as it is only one thread at a time. Objects that are specifically restricted to the main thread of an application are called out as such.</p></li><li class="li"><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_38"></a>The main thread of the application is responsible for handling events. Although the Application Kit continues to work if other threads are involved in the event path, operations can occur out of sequence.</p></li><li class="li"><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_39"></a><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_40"></a>If you want to use a thread to draw to a view, bracket all drawing code between the <code><a href="https://developer.apple.com/reference/appkit/nsview/1483285-lockfocusifcandraw" target="_self" class="urlLink">lockFocusIfCanDraw</a></code> and <code><a href="https://developer.apple.com/reference/appkit/nsview/1483711-unlockfocus" target="_self" class="urlLink">unlockFocus</a></code> methods of <code><a href="https://developer.apple.com/reference/appkit/nsview" target="_self" class="urlLink">NSView</a></code>.</p></li><li class="li"><p>To use POSIX threads with Cocoa, you must first put Cocoa into multithreaded mode. For more information, see <span class="content_text"><a href="../CreatingThreads/CreatingThreads.html#//apple_ref/doc/uid/20000738-125024" data-renderer-version="1">Using POSIX Threads in a Cocoa Application</a></span>. </p></li></ul><section><a name="//apple_ref/doc/uid/20000736-122647" title="Foundation Framework Thread Safety"></a><a name="//apple_ref/doc/uid/10000057i-CH12-122647-BBCCEGFF" title="Foundation Framework Thread Safety"></a><h3 class="jump">Foundation Framework Thread Safety</h3><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_41"></a>There is a misconception that the Foundation framework is thread-safe and the Application Kit framework is not. Unfortunately, this is a gross generalization and somewhat misleading. Each framework has areas that are thread-safe and areas that are not thread-safe. The following sections describe the general thread safety of the Foundation framework. </p><section><a name="//apple_ref/doc/uid/10000057i-CH12-125828" title="Thread-Safe Classes and Functions"></a><h4 class="jump">Thread-Safe Classes and Functions</h4><p>The following classes and functions are generally considered to be thread-safe. You can use the same instance from multiple threads without first acquiring a lock. </p><ul class="simple"><li><p><code><a href="https://developer.apple.com/reference/foundation/nsarray" target="_self" class="urlLink">NSArray</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsassertionhandler" target="_self" class="urlLink">NSAssertionHandler</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsattributedstring" target="_self" class="urlLink">NSAttributedString</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/bundle" target="_self" class="urlLink">NSBundle</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nscalendar" target="_self" class="urlLink">NSCalendar</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nscalendardate" target="_self" class="urlLink">NSCalendarDate</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nscharacterset" target="_self" class="urlLink">NSCharacterSet</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsconditionlock" target="_self" class="urlLink">NSConditionLock</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsconnection" target="_self" class="urlLink">NSConnection</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsdata" target="_self" class="urlLink">NSData</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsdate" target="_self" class="urlLink">NSDate</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/dateformatter" target="_self" class="urlLink">NSDateFormatter</a></code></p></li><li><p><code>NSDecimal</code> functions</p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsdecimalnumber" target="_self" class="urlLink">NSDecimalNumber</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsdecimalnumberhandler" target="_self" class="urlLink">NSDecimalNumberHandler</a></code></p></li><li><p><code><!--a target="_self" -->NSDeserializer<!--/a--></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsdictionary" target="_self" class="urlLink">NSDictionary</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsdistantobject" target="_self" class="urlLink">NSDistantObject</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsdistributedlock" target="_self" class="urlLink">NSDistributedLock</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsdistributednotificationcenter" target="_self" class="urlLink">NSDistributedNotificationCenter</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsexception" target="_self" class="urlLink">NSException</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsfilemanager" target="_self" class="urlLink">NSFileManager</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/formatter" target="_self" class="urlLink">NSFormatter</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nshost" target="_self" class="urlLink">NSHost</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/jsonserialization" target="_self" class="urlLink">NSJSONSerialization</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nslock" target="_self" class="urlLink">NSLock</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/1395275-nslog" target="_self" class="urlLink">NSLog</a></code>/<code><a href="https://developer.apple.com/reference/foundation/1395074-nslogv" target="_self" class="urlLink">NSLogv</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsmethodsignature" target="_self" class="urlLink">NSMethodSignature</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsnotification" target="_self" class="urlLink">NSNotification</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsnotificationcenter" target="_self" class="urlLink">NSNotificationCenter</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsnumber" target="_self" class="urlLink">NSNumber</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsnumberformatter" target="_self" class="urlLink">NSNumberFormatter</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/objectivec/nsobject" target="_self" class="urlLink">NSObject</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsorderedset" target="_self" class="urlLink">NSOrderedSet</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsportcoder" target="_self" class="urlLink">NSPortCoder</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsportmessage" target="_self" class="urlLink">NSPortMessage</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsportnameserver" target="_self" class="urlLink">NSPortNameServer</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/progress" target="_self" class="urlLink">NSProgress</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsprotocolchecker" target="_self" class="urlLink">NSProtocolChecker</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsproxy" target="_self" class="urlLink">NSProxy</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsrecursivelock" target="_self" class="urlLink">NSRecursiveLock</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsset" target="_self" class="urlLink">NSSet</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsstring" target="_self" class="urlLink">NSString</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsthread" target="_self" class="urlLink">NSThread</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/timer" target="_self" class="urlLink">NSTimer</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nstimezone" target="_self" class="urlLink">NSTimeZone</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsuserdefaults" target="_self" class="urlLink">NSUserDefaults</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsvalue" target="_self" class="urlLink">NSValue</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/xmlparser" target="_self" class="urlLink">NSXMLParser</a></code></p></li><li><p>Object allocation and retain count functions</p></li><li><p>Zone and memory functions</p></li></ul></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-125664" title="Thread-Unsafe Classes"></a><h4 class="jump">Thread-Unsafe Classes</h4><p>The following classes and functions are generally not thread-safe. In most cases, you can use these classes from any thread as long as you use them from only one thread at a time. Check the class documentation for additional details.</p><ul class="simple"><li><p><code><a href="https://developer.apple.com/reference/foundation/nsarchiver" target="_self" class="urlLink">NSArchiver</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsautoreleasepool" target="_self" class="urlLink">NSAutoreleasePool</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nscoder" target="_self" class="urlLink">NSCoder</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nscountedset" target="_self" class="urlLink">NSCountedSet</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsenumerator" target="_self" class="urlLink">NSEnumerator</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/filehandle" target="_self" class="urlLink">NSFileHandle</a></code></p></li><li><p><code>NSHashTable</code> functions</p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsinvocation" target="_self" class="urlLink">NSInvocation</a></code></p></li><li><p><code>NSMapTable</code> functions</p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsmutablearray" target="_self" class="urlLink">NSMutableArray</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsmutableattributedstring" target="_self" class="urlLink">NSMutableAttributedString</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsmutablecharacterset" target="_self" class="urlLink">NSMutableCharacterSet</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsmutabledata" target="_self" class="urlLink">NSMutableData</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsmutabledictionary" target="_self" class="urlLink">NSMutableDictionary</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsmutableorderedset" target="_self" class="urlLink">NSMutableOrderedSet</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsmutableset" target="_self" class="urlLink">NSMutableSet</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsmutablestring" target="_self" class="urlLink">NSMutableString</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/notificationqueue" target="_self" class="urlLink">NSNotificationQueue</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/pipe" target="_self" class="urlLink">NSPipe</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/port" target="_self" class="urlLink">NSPort</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsprocessinfo" target="_self" class="urlLink">NSProcessInfo</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/runloop" target="_self" class="urlLink">NSRunLoop</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/scanner" target="_self" class="urlLink">NSScanner</a></code></p></li><li><p><code><!--a target="_self" -->NSSerializer<!--/a--></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/process" target="_self" class="urlLink">NSTask</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsunarchiver" target="_self" class="urlLink">NSUnarchiver</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsundomanager" target="_self" class="urlLink">NSUndoManager</a></code></p></li><li><p>User name and home directory functions</p></li></ul><p>Note that although <code>NSArchiver</code>, <code>NSCoder</code>, and <code>NSEnumerator</code> objects are themselves thread-safe, they are listed here because it is not safe to change the data objects wrapped by them while they are in use. For example, in the case of an archiver, it is not safe to change the object graph being archived. For an enumerator<a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_42"></a>, it is not safe for any thread to change the enumerated collection. </p></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-SW2" title="Main Thread Only Classes"></a><h4 class="jump">Main Thread Only Classes</h4><p>The following class must be used only from the main thread of an application.</p><ul class="simple"><li><p><code><a href="https://developer.apple.com/reference/foundation/nsapplescript" target="_self" class="urlLink">NSAppleScript</a></code></p></li></ul></section><section><a name="//apple_ref/doc/uid/20000736-126010" title="Mutable Versus Immutable"></a><a name="//apple_ref/doc/uid/10000057i-CH12-126010-BCICDFFI" title="Mutable Versus Immutable"></a><h4 class="jump">Mutable Versus Immutable</h4><p>Immutable objects<a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_43"></a> are generally thread-safe; once you create them, you can safely pass these objects to and from threads. Of course, when using immutable objects, you still need to remember to use reference counts correctly. If you inappropriately release an object you did not retain, you could cause an exception later. </p><p>Mutable objects<a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_44"></a> are generally not thread-safe. To use mutable objects in a threaded application, the application must synchronize access to them using locks. (For more information, see <span class="content_text"><a href="../ThreadSafety/ThreadSafety.html#//apple_ref/doc/uid/10000057i-CH8-SW2" data-renderer-version="1">Atomic Operations</a></span>). In general, the collection classes (for example, <code><a href="https://developer.apple.com/reference/foundation/nsmutablearray" target="_self" class="urlLink">NSMutableArray</a></code>, <code><a href="https://developer.apple.com/reference/foundation/nsmutabledictionary" target="_self" class="urlLink">NSMutableDictionary</a></code>) are not thread-safe when mutations are concerned. That is, if one or more threads are changing the same array, problems can occur. You must lock around spots where reads and writes occur to assure thread safety.</p><p>Even if a method claims to return an immutable object, you should never simply assume the returned object is immutable. Depending on the method implementation, the returned object might be mutable or immutable. For example, a method with the return type of <code><a href="https://developer.apple.com/reference/foundation/nsstring" target="_self" class="urlLink">NSString</a></code> might actually return an <code><a href="https://developer.apple.com/reference/foundation/nsmutablestring" target="_self" class="urlLink">NSMutableString</a></code> due to its implementation. If you want to guarantee that the object you have is immutable, you should make an immutable copy. </p></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-126101" title="Reentrancy"></a><h4 class="jump">Reentrancy</h4><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_45"></a>Reentrancy is only possible where operations “call out” to other operations in the same object or on different objects. Retaining and releasing objects is one such “call out” that is sometimes overlooked.</p><p>The following table lists the portions of the Foundation framework that are explicitly reentrant. All other classes may or may not be reentrant, or they may be made reentrant in the future. A complete analysis for reentrancy has never been done and this list may not be exhaustive.</p><ul class="simple"><li><p>Distributed Objects</p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsconditionlock" target="_self" class="urlLink">NSConditionLock</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsdistributedlock" target="_self" class="urlLink">NSDistributedLock</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nslock" target="_self" class="urlLink">NSLock</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/1395275-nslog" target="_self" class="urlLink">NSLog</a></code>/<code><a href="https://developer.apple.com/reference/foundation/1395074-nslogv" target="_self" class="urlLink">NSLogv</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsnotificationcenter" target="_self" class="urlLink">NSNotificationCenter</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsrecursivelock" target="_self" class="urlLink">NSRecursiveLock</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/runloop" target="_self" class="urlLink">NSRunLoop</a></code></p></li><li><p><code><a href="https://developer.apple.com/reference/foundation/nsuserdefaults" target="_self" class="urlLink">NSUserDefaults</a></code></p></li></ul></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-123234" title="Class Initialization"></a><h4 class="jump">Class Initialization</h4><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_46"></a>The Objective-C runtime system sends an <code>initialize</code><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_47"></a> message to every class object before the class receives any other messages. This gives the class a chance to set up its runtime environment<a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_48"></a> before it’s used. In a multithreaded application, the runtime guarantees that only one thread—the thread that happens to send the first message to the class—executes the <code>initialize</code> method. If a second thread tries to send messages to the class while the first thread is still in the <code>initialize</code> method, the second thread blocks until the <code>initialize</code> method finishes executing. Meanwhile, the first thread can continue to call other methods on the class. The <code>initialize</code> method should not rely on a second thread calling methods of the class; if it does, the two threads become deadlocked.</p><p>Due to a bug in OS X version 10.1.x and earlier, a thread could send messages to a class before another thread finished executing that class’s <code>initialize</code> method. The thread could then access values that have not been fully initialized, perhaps crashing the application. If you encounter this problem, you need to either introduce locks to prevent access to the values until after they are initialized or force the class to initialize itself before becoming multithreaded.</p></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-123281" title="Autorelease Pools"></a><h4 class="jump">Autorelease Pools</h4><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_49"></a>Each thread maintains its own stack of <code><a href="https://developer.apple.com/reference/foundation/nsautoreleasepool" target="_self" class="urlLink">NSAutoreleasePool</a></code> objects<a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_50"></a>. Cocoa expects there to be an autorelease pool always available on the current thread’s stack. If a pool is not available, objects do not get released and you leak memory<a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_51"></a>. An <code>NSAutoreleasePool</code> object is automatically created and destroyed in the main thread of applications based on the Application Kit, but secondary threads (and Foundation-only applications) must create their own before using Cocoa. If your thread is long-lived and potentially generates a lot of autoreleased objects<a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_52"></a>, you should periodically destroy and create autorelease pools (like the Application Kit does on the main thread); otherwise, autoreleased objects accumulate and your memory footprint grows. If your detached thread does not use Cocoa, you do not need to create an autorelease pool.</p></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-123295" title="Run Loops"></a><h4 class="jump">Run Loops</h4><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_53"></a>Every thread has one and only one run loop. Each run loop, and hence each thread, however, has its own set of input modes that determine which input sources are listened to when the run loop is run. The input modes defined in one run loop do not affect the input modes defined in another run loop, even though they may have the same name.</p><p>The run loop for the main thread is automatically run if your application is based on the Application Kit, but secondary threads (and Foundation-only applications) must run the run loop themselves. If a detached thread does not enter the run loop, the thread exits as soon as the detached method finishes executing.</p><p>Despite some outward appearances, the <code><a href="https://developer.apple.com/reference/foundation/runloop" target="_self" class="urlLink">NSRunLoop</a></code> class is not thread safe. You should call the instance methods of this class only from the thread that owns it. <a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_54"></a></p></section></section><section><a name="//apple_ref/doc/uid/20000736-123351" title="Application Kit Framework Thread Safety"></a><a name="//apple_ref/doc/uid/10000057i-CH12-123351-BBCFIIEB" title="Application Kit Framework Thread Safety"></a><h3 class="jump">Application Kit Framework Thread Safety</h3><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_55"></a>The following sections describe the general thread safety of the Application Kit framework.</p><section><a name="//apple_ref/doc/uid/10000057i-CH12-SW3" title="Thread-Unsafe Classes"></a><h4 class="jump">Thread-Unsafe Classes</h4><p>The following classes and functions are generally not thread-safe. In most cases, you can use these classes from any thread as long as you use them from only one thread at a time. Check the class documentation for additional details.</p><ul class="ul"><li class="li"><p><code><a href="https://developer.apple.com/reference/appkit/nsgraphicscontext" target="_self" class="urlLink">NSGraphicsContext</a></code>. For more information, see <span class="content_text"><a href="#//apple_ref/doc/uid/10000057i-CH12-126712" data-renderer-version="1">NSGraphicsContext Restrictions</a></span>.</p></li><li class="li"><p><code><a href="https://developer.apple.com/reference/appkit/nsimage" target="_self" class="urlLink">NSImage</a></code>. For more information, see <span class="content_text"><a href="#//apple_ref/doc/uid/10000057i-CH12-126728" data-renderer-version="1">NSImage Restrictions</a></span>.</p></li><li class="li"><p><code><a href="https://developer.apple.com/reference/appkit/nsresponder" target="_self" class="urlLink">NSResponder</a></code></p></li><li class="li"><p><code><a href="https://developer.apple.com/reference/appkit/nswindow" target="_self" class="urlLink">NSWindow</a></code> and all of its descendants. For more information, see <span class="content_text"><a href="#//apple_ref/doc/uid/10000057i-CH12-123364" data-renderer-version="1">Window Restrictions</a></span>.</p></li></ul></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-SW5" title="Main Thread Only Classes"></a><h4 class="jump">Main Thread Only Classes</h4><p>The following classes must be used only from the main thread of an application.</p><ul class="ul"><li class="li"><p><code><a href="https://developer.apple.com/reference/appkit/nscell" target="_self" class="urlLink">NSCell</a></code> and all of its descendants</p></li><li class="li"><p><code><a href="https://developer.apple.com/reference/appkit/nsview" target="_self" class="urlLink">NSView</a></code> and all of its descendants. For more information, see <span class="content_text"><a href="#//apple_ref/doc/uid/10000057i-CH12-123427" data-renderer-version="1">NSView Restrictions</a></span>.</p></li></ul></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-123364" title="Window Restrictions"></a><h4 class="jump">Window Restrictions</h4><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_56"></a>You can create a window on a secondary thread. The Application Kit ensures that the data structures associated with a window are deallocated on the main thread to avoid race conditions. There is some possibility that window objects may leak in an application that deals with a lot of windows concurrently. </p><p>You can create a modal window on a secondary thread. The Application Kit blocks the calling secondary thread while the main thread runs the modal loop.</p></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-123383" title="Event Handling Restrictions"></a><h4 class="jump">Event Handling Restrictions</h4><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_57"></a>The main thread of the application is responsible for handling events. The main thread is the one blocked in the <code>run</code> method of <code><a href="https://developer.apple.com/reference/appkit/nsapplication" target="_self" class="urlLink">NSApplication</a></code>, usually invoked in an application’s <code>main</code> function. While the Application Kit continues to work if other threads are involved in the event path, operations can occur out of sequence. For example, if two different threads are responding to key events, the keys could be received out of order. By letting the main thread process events, you achieve a more consistent user experience. Once received, events can be dispatched to secondary threads for further processing if desired.</p><p>You can call the <code><a href="https://developer.apple.com/reference/appkit/nsapplication/1428710-postevent" target="_self" class="urlLink">postEvent:atStart:</a></code> method of <code>NSApplication</code> from a secondary thread to post an event to the main thread’s event queue. Order is not guaranteed with respect to user input events, however. The main thread of the application is still responsible for handling events in the event queue.</p></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-123414" title="Drawing Restrictions"></a><h4 class="jump">Drawing Restrictions</h4><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_58"></a>The Application Kit is generally thread-safe when drawing with its graphics functions and classes, including the <code><a href="https://developer.apple.com/reference/appkit/nsbezierpath" target="_self" class="urlLink">NSBezierPath</a></code> and <code><a href="https://developer.apple.com/reference/foundation/nsstring" target="_self" class="urlLink">NSString</a></code> classes. Details for using particular classes are described in the following sections. Additional information about drawing and threads is available in <em><a href="../../CocoaDrawingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40003290" data-renderer-version="1" target="_self">Cocoa Drawing Guide</a></em>. </p><section><a name="//apple_ref/doc/uid/10000057i-CH12-123427" title="NSView Restrictions"></a><h5 class="jump">NSView Restrictions</h5><p>The <code><a href="https://developer.apple.com/reference/appkit/nsview" target="_self" class="urlLink">NSView</a></code> class<a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_59"></a> is generally not thread-safe. You should create, destroy, resize, move, and perform other operations on <code>NSView</code> objects only from the main thread of an application. Drawing from secondary threads is thread-safe as long as you bracket drawing calls with calls to <code><a href="https://developer.apple.com/reference/appkit/nsview/1483285-lockfocusifcandraw" target="_self" class="urlLink">lockFocusIfCanDraw</a></code><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_60"></a> and <code><a href="https://developer.apple.com/reference/appkit/nsview/1483711-unlockfocus" target="_self" class="urlLink">unlockFocus</a></code><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_61"></a>. </p><p>If a secondary thread of an application wants to cause portions of the view to be redrawn on the main thread, it must not do so using methods like <code>display</code>, <code><a href="https://developer.apple.com/reference/appkit/nsview/1483360-needsdisplay" target="_self" class="urlLink">setNeedsDisplay:</a></code>, <code><a href="https://developer.apple.com/reference/appkit/nsview/1483475-setneedsdisplay" target="_self" class="urlLink">setNeedsDisplayInRect:</a></code>, or <code><a href="https://developer.apple.com/reference/appkit/nswindow/1419609-viewsneeddisplay" target="_self" class="urlLink">setViewsNeedDisplay:</a></code>. Instead, it should send a message to the main thread or call those methods using the <code><a href="https://developer.apple.com/reference/objectivec/nsobject/1414900-performselectoronmainthread" target="_self" class="urlLink">performSelectorOnMainThread:withObject:waitUntilDone:</a></code><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_62"></a> method instead. </p><p>The view system’s graphics states (gstates<a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_63"></a>) are per-thread. Using graphics states used to be a way to achieve better drawing performance over a single-threaded application but that is no longer true. Incorrect use of graphics states can actually lead to drawing code that is less efficient than drawing in the main thread.</p></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-126712" title="NSGraphicsContext Restrictions"></a><h5 class="jump">NSGraphicsContext Restrictions</h5><p>The <code><a href="https://developer.apple.com/reference/appkit/nsgraphicscontext" target="_self" class="urlLink">NSGraphicsContext</a></code> class<a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_64"></a> represents the drawing context provided by the underlying graphics system. Each <code>NSGraphicsContext</code> instance holds its own independent graphics state: coordinate system, clipping, current font, and so on. An instance of the class is automatically created on the main thread for each <code><a href="https://developer.apple.com/reference/appkit/nswindow" target="_self" class="urlLink">NSWindow</a></code> instance. If you do any drawing from a secondary thread, a new instance of <code>NSGraphicsContext</code> is created specifically for that thread.</p><p>If you do any drawing from a secondary thread, you must flush your drawing calls manually. Cocoa does not automatically update views with content drawn from secondary threads, so you need to call the <code><a href="https://developer.apple.com/reference/appkit/nsgraphicscontext/1527919-flushgraphics" target="_self" class="urlLink">flushGraphics</a></code> method of <code>NSGraphicsContext</code> when you finish your drawing. If your application draws content from the main thread only, you do not need to flush your drawing calls.</p></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-126728" title="NSImage Restrictions"></a><h5 class="jump">NSImage Restrictions</h5><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_65"></a>One thread can create an <code><a href="https://developer.apple.com/reference/appkit/nsimage" target="_self" class="urlLink">NSImage</a></code> object, draw to the image buffer, and pass it off to the main thread for drawing. The underlying image cache is shared among all threads. For more information about images and how caching works, see <em><a href="../../CocoaDrawingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40003290" data-renderer-version="1" target="_self">Cocoa Drawing Guide</a></em>. <a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_66"></a><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_67"></a></p></section></section></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-SW7" title="Core Data Framework"></a><h3 class="jump">Core Data Framework</h3><p>The Core Data framework generally supports threading, although there are some usage caveats that apply. For information on these caveats, see <span class="content_text"><!--a target="_self" -->Concurrency with Core Data<!--/a--></span> in <em><a href="../../CoreData/index.html#//apple_ref/doc/uid/TP40001075" data-renderer-version="2" target="_self">Core Data Programming Guide</a></em>.</p></section></section><section><a name="//apple_ref/doc/uid/10000057i-CH12-SW9" title="Core Foundation"></a><h2 class="jump">Core Foundation</h2><p><a name="//apple_ref/doc/uid/10000057i-CH12-DontLinkElementID_68"></a>Core Foundation is sufficiently thread-safe that, if you program with care, you should not run into any problems related to competing threads. It is thread-safe in the common cases, such as when you query, retain, release, and pass around immutable objects. Even central shared objects that might be queried from more than one thread are reliably thread-safe.</p><p>Like Cocoa, Core Foundation is not thread-safe when it comes to mutations to objects or their contents. For example, modifying a mutable data or mutable array object is not thread-safe, as you might expect, but neither is modifying an object inside of an immutable array. One reason for this is performance, which is critical in these situations. Moreover, it is usually not possible to achieve absolute thread safety at this level. You cannot rule out, for example, indeterminate behavior resulting from retaining an object obtained from a collection. The collection itself might be freed before the call to retain the contained object is made.</p><p>In those cases where Core Foundation objects are to be accessed from multiple threads and mutated, your code should protect against simultaneous access by using locks at the access points. For instance, the code that enumerates the objects of a Core Foundation array should use the appropriate locking calls around the enumerating block to protect against someone else mutating the array. </p></section>
        <div id="pageNavigationLinks_bottom" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='../Glossary/Glossary.html'>Next</a><a class='previousLink' rel='prev' href='../ThreadSafety/ThreadSafety.html'>Previous</a>
        </div><br/>
        <div class="copyright"><br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> Copyright &#x00a9; 2014 Apple Inc. All Rights Reserved. <a href="http://www.apple.com/legal/internet-services/terms/site.html" target="_blank">Terms of Use</a>   |  <a href="http://www.apple.com/privacy/" target="_blank">Privacy Policy</a>  |  Updated: 2014-07-15</p></div></div>

        <div id="pediaWindow">
            <div id="pediaHeader"></div>
            <div id="pediaBody"></div>
        </div>
    </article>

    <div id="blackout">
    <div id="preload"></div>
</div>
<div id="leave_feedback" class="button" role="button" tabindex="0">Feedback</div>
<div id="modal" aria-hidden="true">
    <div id="closebox" tabindex="0" aria-label="Close feedback form" role="button"></div>
    <div id="sending" class="hidden">
        <h2 tabindex="0">Sending feedback&hellip;</h2>
        <div id="sending_img"></div>
    </div>
    <div id="error" class="hidden">
        <h2 tabindex="0">We&rsquo;re sorry, an error has occurred.</h2>
        <p>Please try submitting your feedback later.</p>
        <div id="error_icon"></div>
    </div>
    <div id="success" class="hidden">
        <h2 tabindex="0">Thank you for providing feedback!</h2>
        <p>Your input helps improve our developer documentation.</p>
        <div id="thank_you_icon"></div>
    </div>
    
    <form id="feedback" action="#" method="post">
        <div class="left-leaf">
            <h2 id="helpful_title" data-asterisk="a1" tabindex="0">How helpful is this document?</h2>     
            <sup id="a1" class="asterisk" aria-hidden="true">*</sup>

            <div id="star_group" role="radiogroup" aria-required="true">
                <label> 
                    <input class="radio" type="radio" name="helped" value="1" /> 
                    Very helpful
                </label>
                <label> 
                    <input class="radio" type="radio" name="helped" value="2" /> 
                    Somewhat helpful
                </label>
                <label>
                    <input class="radio" type="radio" name="helped" value="3" /> 
                    Not helpful
                </label>
            </div>
        </div>
        <div class="right-leaf">
            <h2>How can we improve this document?</h2>
            <div id="improve" class="checkboxes">
                <label>
                    <input type="checkbox" name="typo" /> 
                    Fix typos or links
                </label>
                <label>
                    <input type="checkbox" name="infoIncorrect" /> 
                    Fix incorrect information
                </label>
                <label>
                    <input type="checkbox" name="needs_examples" /> 
                    Add or update code samples
                </label>
                <label>
                    <input type="checkbox" name="needs_art" /> 
                    Add or update illustrations
                </label>
                <label>
                    <input type="checkbox" name="missingInfo" /> 
                    Add information about...
                </label>
            </div>
        </div>

        <textarea id="comment" name="problem" cols="70" rows="8" placeholder="Please tell us more about your experience with this document" data-asterisk="a2" required></textarea>
        <sup id="a2" class="asterisk" aria-hidden="true">*</sup>

        <p class="fineprint">
            <em aria-hidden="true"><span>*</span> Required information</em>
        </p> 

        <input id="submit" type="button" value="Send" />

        <section id="legal">
            <p>
                To submit a product bug or enhancement request, please visit the 
                <a href="https://developer.apple.com/bugreporter/" target="_blank">Bug Reporter</a> 
                page.
            </p>
            <p>
                Please read <a href="http://www.apple.com/legal/policies/ideas.html" target="_blank">Apple's Unsolicited Idea Submission Policy</a> 
                before you send us your feedback.
            </p> 
        </section>
    </form>
</div>

    
    <script charset="utf-8" src="../../../../../Resources/1260/JavaScript/lib/prototype.js"></script>
    <script src="../../../../../Resources/1260/JavaScript/library.js"></script>
    <script src="../../../../../Resources/1260/JavaScript/feedback.js"></script>
</body>
</html>
