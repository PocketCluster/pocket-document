<!DOCTYPE html>
<html lang="en">
<head>
    <title>Understanding the Code Signature</title>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta charset="utf-8">
    <meta id="book-resource-type" name="book-resource-type" content="Guide">
    <meta scheme="apple_ref" id="identifier" name="identifier" content="//apple_ref/doc/uid/TP40005929">
    <meta id="document-version" name="document-version" content="7.0.8">
    <meta id="build" name="build" content="88ffd7de8b734e5b1917ba7e99783a21" />
    <meta id="chapterId" name="chapterId" content="TP40005929-CH3">
    <meta id="date" name="date" content="2016-09-13">
    <meta id="description" name="description" content="Explains how to use command-line tools to sign your code.">
    <meta id="book-title" name="book-title" content="Code Signing Guide">
    <meta id="book-root" name="book-root" content="../">
    <meta id="book-json" name="book-json" content="../book.json">
    <meta id="devcenter" name="devcenter" content="Mac Dev Center">
    <meta id="devcenter-url" name="devcenter-url" content="http://developer.apple.com/devcenter/mac">
    <meta id="reflib" name="reflib" content="Guides and Sample Code">
    <meta id="book-assignments" name="book-assignments" content="{Type/Guide}, {Technologies/Core Services Layer/Security}, {Topic/Security}">
    
    
    <meta id="copyright" name="copyright" content="Copyright 2017 Apple Inc. All Rights Reserved.">
    <meta id="xcode-display" name="xcode-display" content="render">
    <meta id="IndexTitle" name="IndexTitle" content="Code Signing Guide: Understanding the Code Signature">
    <meta id="resources-uri" name="resources-uri" content="../../../../../Resources/1260">
    <link id="book-index-page" rel="Start" title="Code Signing Guide" type="text/html" href="../index.html">
    <link id="next-page" rel="Next" type="text/html" href="../Procedures/Procedures.html">
    <link id="previous-page" rel="Prev" type="text/html" href="../Introduction/Introduction.html">
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1260/CSS/screen.css">
    
    <!-- xcode_css -->
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1260/CSS/feedback.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta id="platforms" name="platforms" content="">
</head>    
<body><a name="//apple_ref/doc/uid/TP40005929-CH3" title="Understanding the Code Signature"></a>
    <div id="_omniture_top">
    <!-- SiteCatalyst code version: H.8. Copyright 1997-2006 Omniture, Inc. -->
    <script type="text/javascript">
    /* RSID: */
    var s_account="appleglobal,appleusdeveloper,dappdeveloperlib"
    </script>

    <script type="text/javascript" src="https://www.apple.com/metrics/scripts/s_code_h.js"></script>
    <script type="text/javascript">
    s.pageName=AC.Tracking.pageName();
    s.channel="www.us.developer"

    /************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
    var s_code=s.t();if(s_code)document.write(s_code)</script>
    <!-- End SiteCatalyst code version: H.8. -->
    </div>

    <div id="adcHeader" class="hideOnPrint hideInXcode">
        <div id='ssi_Header' class="hideInXcode unified">
            <a id="ssi_LibraryTitle" href='../../../../../navigation/'>Guides and Sample Code</a>
            <a id="ssi_AppleDeveloperConnection" href='https://developer.apple.com/'>Developer</a>
            <div id='ssi_SearchButton' role="button" title="Search">Search</div>
        </div>
        <form id='ssi_SearchMenu' method='get' action='../../../../../search/' accept-charset='utf-8'>
            <label for='adcsearch'>Search Guides and Sample Code</label>
            
            
    
            <input type='search' id='ssi_SearchField' name='q' accesskey='s' results='5' />
        </form>
    </div>

    <header id="header">
        <div id="title" role="banner">
            <h1>Code Signing Guide</h1>
            <span id="file_links">
                <a id="PDF_link" role="button" tabindex='4' rel="alternate" title="Download PDF"><span id="pdf_icon"></span>PDF</a>
                <a id="Companion_link" role="button" tabindex='3' title="Download Companion File"><span id="companion_icon"></span>Companion File</a>
            </span>
        </div>
        <ul id="headerButtons" class="hideOnPrint" role="toolbar">
            <li id="toc_button" style="display:none">
                <button tabindex="5" id="table_of_contents" class="open" role="checkbox" aria-label="Show Table of Contents"><span class="disclosure"></span>Table of Contents</button>
            </li>
            <li id="jumpto_button" style="display:none" role="navigation"><select tabindex="6" id="jumpTo"><option value="top">Jump To&#133;</option></select></li>
            <li id="downloadSample_button" style="display:none">
                <a id="Sample_link"><button id="Sample_button">Download Sample Code</button></a>
            </li>
        </ul>
    </header>
    <nav id="tocContainer" tabindex="7">
        <ul id="toc" role="tree"></ul>
    </nav>

    <article id="contents" tabindex="0" role="main">
        <div id="pageNavigationLinks_top" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='../Procedures/Procedures.html'>Next</a><a class='previousLink' rel='prev' href='../Introduction/Introduction.html'>Previous</a>
        </div>
        <a id="top" name="top"></a>
        <a id="INDEX" href="../index.html" style="display:none;"></a>
        
        <a name="//apple_ref/doc/uid/TP40005929-CH3-SW3" title="Understanding the Code Signature"></a><h1 id="pageTitle">Understanding the Code Signature</h1><p>All sorts of code can be signed, including tools, applications, scripts, libraries, plug-ins, and other “code-like” data. In addition, you can create signed installer packages, and signed disk images. In all cases, the code signature consists of three parts:</p><ul class="ul"><li class="li"><p><strong>A seal.</strong> This is a collection of checksums or hashes of the various parts of the code, created by the code signing software. The seal can be used at verification time to detect alterations.</p></li><li class="li"><p><strong>A digital signature.</strong> The code signing software encrypts the seal using the signer’s identity to create a digital signature. This guarantees the seal’s integrity.</p></li><li class="li"><p><strong>Code requirements.</strong> These are the rules governing verification of the code signature. Some are inherent to the verifier (depending on its goals). Others are specified by the signer and sealed with the rest of the code. </p></li></ul><section><a name="//apple_ref/doc/uid/TP40005929-CH3-SW1" title="The Seal"></a><h2 class="jump">The Seal</h2><p>The code signing machinery generates the seal by running different parts of your final bundle (app, library, or framework), including executables, resources, the <code>Info.plist</code> file, code requirements, and so on, through a one-way hashing algorithm. This produces a series of digests, or checksums, which are short strings of digits that are unique to a particular input block, but which cannot be used to reconstruct the original input.</p><p>A verifying entity that has both the code under evaluation, and the corresponding collection of hashes, runs the same hashing algorithm on the code in exactly the same way as the signer, and compares the results to the original, stored hashes to see if anything has changed. Even a small modification in the code results in a different digest, which indicates tampering or corruption. However, this verification is only as reliable as the reliability of the stored hash. The digital signature guarantees this.</p></section><section><a name="//apple_ref/doc/uid/TP40005929-CH3-SW2" title="The Digital Signature"></a><h2 class="jump">The Digital Signature</h2><p>As explained in <em><a href="../../Security_Overview/Introduction/Introduction.html#//apple_ref/doc/uid/TP30000976" data-renderer-version="1" target="_self">Security Overview</a></em>, a digital signature uses public key cryptography to ensure data integrity. Like a signature written with ink on paper, a digital signature can be used to identify and authenticate the signer. However, a digital signature is more difficult to forge, and goes one step further: it can ensure that the signed data has not been altered. This is somewhat like designing a paper check or money order in such a way that if someone alters the written amount of money, a watermark with the text “Invalid” becomes visible on the paper.</p><p>In the context of code signing, the signing software creates the digital signature by encrypting the seal’s hashes with the signer’s private key. Because only the signer possesses the private key, only the signer is able to perform this encryption. It is this collection of encrypted hashes that the signer stores in the app (or framework, archive, or other signed object), along with the matching certificate, which collectively represent the digital signature.</p><p>To verify the signature, the verifying software computes the same set of hashes across the various blocks of code and data. It then uses the signer’s public key, which is embedded in the certificate, to decrypt the encrypted hashes that came with the code, thus obtaining the original hash as computed by the signer. If the two hashes match, the data has not been modified since it was signed by someone in possession of the signer’s private key.</p><p>Although not strictly required for code signing to work, the certificate itself is usually signed by a trusted certificate authority. If not, the verifier can be sure of the certificate’s stability from one release to another, but not of its origin. If it is, the certificate authority, often Apple, vouches for the identity of the signer.</p><p>Signed code may contain several different digital signatures:</p><ul class="ul"><li class="li"><p>If the code is universal, the object code for each slice (architecture) is signed separately. This signature is stored within the binary file itself.</p></li><li class="li"><p>Various data components of the application bundle (such as the <code>Info.plist</code> file, if there is one) are also signed. These signatures are stored in a file called <code>_CodeSignature/CodeResources</code> within the bundle.</p></li><li class="li"><p>Nested code, such as libraries, helper tools, and other bits of code that are embedded in the app are themselves signed, and their signatures are also stored in <code>_CodeSignature/CodeResources</code> within the bundle.</p></li></ul></section><section><a name="//apple_ref/doc/uid/TP40005929-CH3-SW4" title="Code Requirements"></a><h2 class="jump">Code Requirements</h2><p>Code requirements are the rules macOS uses to evaluate a code signature. The system doing the evaluating decides what code requirements to apply at evaluation time, depending on its goals. For example, Gatekeeper has a rule that, before an app is allowed to launch for the first time, it must be signed by a Mac App Store or Developer ID certificate. As another example, an app could enforce a code requirement that all plug-ins used by that app should be signed by Apple.</p><p>Code requirements specified by the signer and included as part of the code signature are known as <em class="newTerm">internal requirements</em>. These are available to the system verifying a code signature, but the system may choose to use them or not. A plug-in for the app in the previous example might come with its own internal requirements, but it would be up to the evaluating system, the app using the plug-in, to decide whether to apply them. Because the seal covers the code requirements, the internal requirements are also certain to be intact as long as the signature is valid.</p><p>The most important internal requirement is the <em class="newTerm">designated requirement</em>, or DR. This rule tells an evaluating system how to identify a particular piece of code. Any two pieces of code that have (and successfully verify against) the same DR are considered to be the same code. This allows a code signer to publish a new version of an app that is treated as the same app. For example, the DR for Apple Mail might be "was signed by Apple and has the identifier <code>com.apple.Mail</code>". When a new version of the app is published, as long as a new version of the app has the same DR, it is still considered Apple Mail, even if the binary executable is completely different. Further, only Apple can sign as Apple, so no one else can make an app that masquerades as the Mail app.</p><p>The program identifier or the entire designated requirement can be specified explicitly by the signer. Typically, the signing machinery automatically builds a designated requirement using the name of the program found in its <code>Info.plist</code> file as the <code>CFBundleIdentifier</code>, and the chain of signatures securing the code signature. </p><p>In practical terms, code requirements are stated as scripts, written in a dedicated language, that describe conditions (restrictions) code must satisfy to be acceptable for some purpose. See <span class="content_text"><a href="../RequirementLang/RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW1" data-renderer-version="1">Code Signing Requirement Language</a></span> for a detailed description of the code requirement scripting language.</p></section><section><a name="//apple_ref/doc/uid/TP40005929-CH3-SW5" title="Code Signature Evaluation"></a><h2 class="jump">Code Signature Evaluation</h2><p>macOS subsystems perform validation of signed code against a set of requirements when they need to determine whether it is safe to trust that code for some purpose. As described in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40005929-CH3-SW2" data-renderer-version="1">The Digital Signature</a></span>, internal requirements, and especially the designated requirement, come from the code signature itself. Other requirements are inherent to the system doing the verification.</p><p><span class="content_text">Table 2-1</span> gives concrete examples of how code signatures are used by different subsystems in macOS to enforce trust policies that are specific to a particular kind of system resource. Note that these are default behaviors; you can modify many of the code signing polices of macOS with the <code><!--a target="_self" -->spctl(8)<!--/a--></code> command.</p><a name="//apple_ref/doc/uid/TP40005929-CH3-TABLE1" title="Table 2-1Examples of macOS subsystems that verify the validity of code"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 2-1</strong>&nbsp;&nbsp;Examples of macOS subsystems that verify the validity of code</caption><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Subsystem
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Function
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Initial policy
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Tracking policy
</p></th></tr><tr><td  scope="row"><p>
App Sandbox
</p></td><td ><p>
Gates access to system resources based on entitlements.
</p></td><td ><p>
Allow if entitlement is present in the app's code signature.
</p></td><td ><p>
Initial policy decision verified against the application's DR.
</p></td></tr><tr><td  scope="row"><p>
Gatekeeper
</p></td><td ><p>
Restricts launching of applications from unidentified developers
</p></td><td ><p>
A configurable trusted anchor check (Developer ID or Mac App Store).
</p></td><td ><p>
None (each request evaluated independently).
</p></td></tr><tr><td  scope="row"><p>
Application Firewall
</p></td><td ><p>
Restricts inbound network access by applications.
</p></td><td ><p>
Allow if a trusted anchor check succeeds; otherwise prompt the user.
</p></td><td ><p>
Initial policy decision verified against the application's DR.
</p></td></tr><tr><td  scope="row"><p>
Parental Controls (MCX)
</p></td><td ><p>
Restricts what applications a managed user can run.
</p></td><td ><p>
Explicit administrator decision (no code signing involved in the initial decision).
</p></td><td ><p>
Initial policy decision verified against the application's DR.
</p></td></tr><tr><td  scope="row"><p>
Keychain Access Controls
</p></td><td ><p>
Controls what applications can do with specific keychain items.
</p></td><td ><p>
The creating application is automatically trusted with its item, and determines the access policy using code signing requirements.
</p></td><td ><p>
Free access to the keychain item by the creating application and tracked with its DR (No automatic tracking for custom ACLs).
</p></td></tr><tr><td  scope="row"><p>
Developer Tools Access (DTA)
</p></td><td ><p>
Restricts what programs are allowed to call DTA APIs (task_for_pid, etc.)
</p></td><td ><p>
A hard-coded trusted anchor check.
</p></td><td ><p>
None (each request evaluated independently).
</p></td></tr></table></div><p>The above examples demonstrate how policy decisions are determined by specific subsystems and not by code signing itself. In addition, they highlight the diversity of policies. For example:</p><ul class="ul"><li class="li"><p>DTA doesn't have a tracking policy. It simply applies a set requirement to every requester without needing to retain any information.</p></li><li class="li"><p>Application Firewall uses code signing for both its initial and tracking policy decisions.</p></li><li class="li"><p>The keychain acts on the tracking policy by default but it can also allow arbitrary requirement-bearing ACLs to be added to express arbitrary policies determined by the owner of a specific keychain item.</p></li><li class="li"><p>App Sandbox relies on entitlements embedded in the code signature to decide when to grant access to the system resources that your app requires, such as network connections, the camera, parts of the file system, and so on. Because entitlements are part of, and thus sealed by, the code signature, App Sandbox trusts that these are the resources the developer intended to request.</p><p>In fact, all entitlements (for App Sandbox or otherwise) are stored in and sealed by the code signature, so any app that uses entitlements of any kind requires a code signature.</p></li></ul><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40005929-CH3-SW6" title="Note"></a><p><strong>Note:</strong>&nbsp;The keychain access controls allow you to associate arbitrary code signing requirements with keychain items. This means that trusted anchor requirements can be attached to keychain items, either with explicit API calls, or by creating an item with an application whose designated requirement has been explicitly set to require a trusted anchor. For a complete description of the Keychain Services API that lets you manipulate keychain item access objects, read <em><a href="https://developer.apple.com/reference/security/keychain_services" class="urlLink" target="_self">Keychain Services Reference</a></em>.</p><p></p></aside></div><p>Some parts of macOS do not care about the identity of the signer. They care only whether the app is <em>validly signed and stable</em>. Stability is determined through the DR, and does not depend on the nature of the certificate authority used. The keychain system and parental controls are examples of such usage. Self-signed identities and homemade certificate authorities (CA) work by default for this case. Because they do not work for Gatekeeper, they are generally not recommended for distribution, but they may be useful during development or for test purposes.</p><p>Other parts of macOS constrain acceptable signatures to only those drawn from certificate authorities that are trusted on the system performing the validation. For those checks, the nature of the identity certificate used does matter. The Application Firewall is one example of this usage. Self-signed identities and self-created certificate authorities are not valid for this check unless the verifying system has been told to trust them for Application Firewall purposes.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40005929-CH3-SW7" title="Note"></a><p><strong>Note:</strong>&nbsp;In order for a new identity certificate to be designated as being a trusted anchor for a particular subsystem, the user must take action to accept this policy addition. For a system-wide trust entry, higher privileges are needed: An administrator user is required to accept the policy addition.</p><p></p></aside></div><p>For the most part, policy decisions are made at a single point in time, which may affect system behavior. For example, unsigned code injected into an application through a buffer overflow can still execute because it was not part of the application at launch time, and thus not evaluated by Gatekeeper.</p></section>
        <div id="pageNavigationLinks_bottom" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='../Procedures/Procedures.html'>Next</a><a class='previousLink' rel='prev' href='../Introduction/Introduction.html'>Previous</a>
        </div><br/>
        <div class="copyright"><br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> Copyright &#x00a9; 2016 Apple Inc. All Rights Reserved. <a href="http://www.apple.com/legal/internet-services/terms/site.html" target="_blank">Terms of Use</a>   |  <a href="http://www.apple.com/privacy/" target="_blank">Privacy Policy</a>  |  Updated: 2016-09-13</p></div></div>

        <div id="pediaWindow">
            <div id="pediaHeader"></div>
            <div id="pediaBody"></div>
        </div>
    </article>

    <div id="blackout">
    <div id="preload"></div>
</div>
<div id="leave_feedback" class="button" role="button" tabindex="0">Feedback</div>
<div id="modal" aria-hidden="true">
    <div id="closebox" tabindex="0" aria-label="Close feedback form" role="button"></div>
    <div id="sending" class="hidden">
        <h2 tabindex="0">Sending feedback&hellip;</h2>
        <div id="sending_img"></div>
    </div>
    <div id="error" class="hidden">
        <h2 tabindex="0">We&rsquo;re sorry, an error has occurred.</h2>
        <p>Please try submitting your feedback later.</p>
        <div id="error_icon"></div>
    </div>
    <div id="success" class="hidden">
        <h2 tabindex="0">Thank you for providing feedback!</h2>
        <p>Your input helps improve our developer documentation.</p>
        <div id="thank_you_icon"></div>
    </div>
    
    <form id="feedback" action="#" method="post">
        <div class="left-leaf">
            <h2 id="helpful_title" data-asterisk="a1" tabindex="0">How helpful is this document?</h2>     
            <sup id="a1" class="asterisk" aria-hidden="true">*</sup>

            <div id="star_group" role="radiogroup" aria-required="true">
                <label> 
                    <input class="radio" type="radio" name="helped" value="1" /> 
                    Very helpful
                </label>
                <label> 
                    <input class="radio" type="radio" name="helped" value="2" /> 
                    Somewhat helpful
                </label>
                <label>
                    <input class="radio" type="radio" name="helped" value="3" /> 
                    Not helpful
                </label>
            </div>
        </div>
        <div class="right-leaf">
            <h2>How can we improve this document?</h2>
            <div id="improve" class="checkboxes">
                <label>
                    <input type="checkbox" name="typo" /> 
                    Fix typos or links
                </label>
                <label>
                    <input type="checkbox" name="infoIncorrect" /> 
                    Fix incorrect information
                </label>
                <label>
                    <input type="checkbox" name="needs_examples" /> 
                    Add or update code samples
                </label>
                <label>
                    <input type="checkbox" name="needs_art" /> 
                    Add or update illustrations
                </label>
                <label>
                    <input type="checkbox" name="missingInfo" /> 
                    Add information about...
                </label>
            </div>
        </div>

        <textarea id="comment" name="problem" cols="70" rows="8" placeholder="Please tell us more about your experience with this document" data-asterisk="a2" required></textarea>
        <sup id="a2" class="asterisk" aria-hidden="true">*</sup>

        <p class="fineprint">
            <em aria-hidden="true"><span>*</span> Required information</em>
        </p> 

        <input id="submit" type="button" value="Send" />

        <section id="legal">
            <p>
                To submit a product bug or enhancement request, please visit the 
                <a href="https://developer.apple.com/bugreporter/" target="_blank">Bug Reporter</a> 
                page.
            </p>
            <p>
                Please read <a href="http://www.apple.com/legal/policies/ideas.html" target="_blank">Apple's Unsolicited Idea Submission Policy</a> 
                before you send us your feedback.
            </p> 
        </section>
    </form>
</div>

    
    <script charset="utf-8" src="../../../../../Resources/1260/JavaScript/lib/prototype.js"></script>
    <script src="../../../../../Resources/1260/JavaScript/library.js"></script>
    <script src="../../../../../Resources/1260/JavaScript/feedback.js"></script>
</body>
</html>
