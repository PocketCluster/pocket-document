<!DOCTYPE html>
<html lang="en">
<head>
    <title>Using Dynamic Libraries</title>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta charset="utf-8">
    <meta id="book-resource-type" name="book-resource-type" content="Guide">
    <meta scheme="apple_ref" id="identifier" name="identifier" content="//apple_ref/doc/uid/TP40001869">
    <meta id="document-version" name="document-version" content="1.10.0">
    <meta id="build" name="build" content="ded95564c405529dbbbe590063edd114" />
    <meta id="chapterId" name="chapterId" content="TP40002182">
    <meta id="date" name="date" content="2012-07-23">
    <meta id="description" name="description" content="Explains how to design, implement, and use dynamic libraries.">
    <meta id="book-title" name="book-title" content="Dynamic Library Programming Topics">
    <meta id="book-root" name="book-root" content="../">
    <meta id="book-json" name="book-json" content="../book.json">
    <meta id="devcenter" name="devcenter" content="Mac Dev Center">
    <meta id="devcenter-url" name="devcenter-url" content="http://developer.apple.com/devcenter/mac">
    <meta id="reflib" name="reflib" content="Guides and Sample Code">
    <meta id="book-assignments" name="book-assignments" content="{Type/Guide}, {Topic/General}">
    
    
    <meta id="copyright" name="copyright" content="Copyright 2017 Apple Inc. All Rights Reserved.">
    <meta id="xcode-display" name="xcode-display" content="render">
    <meta id="IndexTitle" name="IndexTitle" content="Dynamic Library Programming Topics: Using Dynamic Libraries">
    <meta id="resources-uri" name="resources-uri" content="../../../../../Resources/1260">
    <link id="book-index-page" rel="Start" title="Dynamic Library Programming Topics" type="text/html" href="../index.html">
    <link id="next-page" rel="Next" type="text/html" href="RunpathDependentLibraries.html">
    <link id="previous-page" rel="Prev" type="text/html" href="CreatingDynamicLibraries.html">
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1260/CSS/screen.css">
    
    <!-- xcode_css -->
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1260/CSS/feedback.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta id="platforms" name="platforms" content="">
</head>    
<body><a name="//apple_ref/doc/uid/TP40002182" title="Using Dynamic Libraries"></a>
    <div id="_omniture_top">
    <!-- SiteCatalyst code version: H.8. Copyright 1997-2006 Omniture, Inc. -->
    <script type="text/javascript">
    /* RSID: */
    var s_account="appleglobal,appleusdeveloper,dappdeveloperlib"
    </script>

    <script type="text/javascript" src="https://www.apple.com/metrics/scripts/s_code_h.js"></script>
    <script type="text/javascript">
    s.pageName=AC.Tracking.pageName();
    s.channel="www.us.developer"

    /************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
    var s_code=s.t();if(s_code)document.write(s_code)</script>
    <!-- End SiteCatalyst code version: H.8. -->
    </div>

    <div id="adcHeader" class="hideOnPrint hideInXcode">
        <div id='ssi_Header' class="hideInXcode unified">
            <a id="ssi_LibraryTitle" href='../../../../../navigation/'>Guides and Sample Code</a>
            <a id="ssi_AppleDeveloperConnection" href='https://developer.apple.com/'>Developer</a>
            <div id='ssi_SearchButton' role="button" title="Search">Search</div>
        </div>
        <form id='ssi_SearchMenu' method='get' action='../../../../../search/' accept-charset='utf-8'>
            <label for='adcsearch'>Search Guides and Sample Code</label>
            
            
    
            <input type='search' id='ssi_SearchField' name='q' accesskey='s' results='5' />
        </form>
    </div>

    <header id="header">
        <div id="title" role="banner">
            <h1>Dynamic Library Programming Topics</h1>
            <span id="file_links">
                <a id="PDF_link" role="button" tabindex='4' rel="alternate" title="Download PDF"><span id="pdf_icon"></span>PDF</a>
                <a id="Companion_link" role="button" tabindex='3' title="Download Companion File"><span id="companion_icon"></span>Companion File</a>
            </span>
        </div>
        <ul id="headerButtons" class="hideOnPrint" role="toolbar">
            <li id="toc_button" style="display:none">
                <button tabindex="5" id="table_of_contents" class="open" role="checkbox" aria-label="Show Table of Contents"><span class="disclosure"></span>Table of Contents</button>
            </li>
            <li id="jumpto_button" style="display:none" role="navigation"><select tabindex="6" id="jumpTo"><option value="top">Jump To&#133;</option></select></li>
            <li id="downloadSample_button" style="display:none">
                <a id="Sample_link"><button id="Sample_button">Download Sample Code</button></a>
            </li>
        </ul>
    </header>
    <nav id="tocContainer" tabindex="7">
        <ul id="toc" role="tree"></ul>
    </nav>

    <article id="contents" tabindex="0" role="main">
        <div id="pageNavigationLinks_top" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='RunpathDependentLibraries.html'>Next</a><a class='previousLink' rel='prev' href='CreatingDynamicLibraries.html'>Previous</a>
        </div>
        <a id="top" name="top"></a>
        <a id="INDEX" href="../index.html" style="display:none;"></a>
        
        <a name="//apple_ref/doc/uid/TP40002182-SW10" title="Using Dynamic Libraries"></a><h1 id="pageTitle">Using Dynamic Libraries</h1><p>When you need to use a dynamic library in your product, you have to install the library in your computer. You may use dynamic libraries as dependent libraries (by specifying them in your product’s link line) or as runtime loaded libraries (by loading them when they are needed, using <code><!--a target="_self" -->dlopen(3) OS X Developer Tools  Manual Page<!--/a--></code>).</p><p>This article describes the process of installing and using dynamic libraries. It’s based on the Ratings dynamic library and the <code>StarMeals</code>, <code>StarMeals2</code>, and <code>Grades</code> programs, which are included in this document’s companion-file package. This article also shows how to use dynamic libraries as dependent libraries  or as runtime-loaded libraries. Finally, this article demonstrates how to interpose the functions exported by a dynamic library.</p><section><a name="//apple_ref/doc/uid/TP40002182-SW12" title="Installing Dependent Libraries"></a><h2 class="jump">Installing Dependent Libraries</h2><p>Before you can use a dynamic library as a dependent library, the library and its header files must be installed on your computer. The standard locations for header files are <code>~/include</code>, <code>/usr/local/include</code> and <code>/usr/include</code>. The standard locations for dynamic libraries are <code>~/lib</code>, <code>/usr/local/lib</code>, and <code>/usr/lib</code>.</p><p>You may also place the <code>.dylib</code> file at a nonstandard location in your file system, but you must add that location to one of these environment variables:</p><ul class="ul"><li class="li"><p><code>LD_LIBRARY_PATH</code></p></li><li class="li"><p><code>DYLD_LIBRARY_PATH</code></p></li><li class="li"><p><code>DYLD_FALLBACK_LIBRARY_PATH</code></p></li></ul><p>For details on how to add paths to these environment variables, see <span class="content_text"><a href="DynamicLibraryUsageGuidelines.html#//apple_ref/doc/uid/TP40001928-SW12" data-renderer-version="1">Opening Dynamic Libraries</a></span>. To learn about installing dependent libraries in a relocatable directory, see <span class="content_text"><a href="RunpathDependentLibraries.html#//apple_ref/doc/uid/TP40008306-SW1" data-renderer-version="1">Run-Path Dependent Libraries</a></span>.</p><p>If you don’t want to change the environment variables and you want to place the dynamic library in a nonstandard location, you must specify where in your file system you placed the library when you link your image. See the description of the compiler <code>-dylib_file</code> option in <span class="content_text"><a href="http://gcc.gnu.org/onlinedocs/gcc/Darwin-Options.html#Darwin-Options" class="urlLink" rel="external">http://gcc.gnu.org/onlinedocs/gcc/Darwin-Options.html#Darwin-Options</a></span> for details.</p><p>For example, in OS X the executable code of apps can be packaged together with frameworks containing libraries created specifically for a particular app. These frameworks are known as <em class="newTerm">private embedded frameworks</em>. Applications that use private embedded frameworks, as well as the frameworks themselves, must be specially built. See “<span class="content_text"><a href="../../../../MacOSX/Conceptual/BPFrameworks/Tasks/CreatingFrameworks.html#//apple_ref/doc/uid/20002258" data-renderer-version="1" target="_self">Creating a Framework</a></span>” in <em><a href="../../../../MacOSX/Conceptual/BPFrameworks/Frameworks.html#//apple_ref/doc/uid/10000183i" data-renderer-version="1" target="_self">Framework Programming Guide</a></em> and “<span class="content_text"><a href="../../MachOTopics/1-Articles/loading_code.html#//apple_ref/doc/uid/TP40001830" data-renderer-version="1" target="_self">Loading Code at Runtime</a></span>” in <em><a href="../../MachOTopics/0-Introduction/introduction.html#//apple_ref/doc/uid/TP40001519" data-renderer-version="1" target="_self">Mach-O Programming Topics</a></em> for details.</p><p><span class="content_text"><a href="#//apple_ref/doc/uid/TP40002182-SW11" data-renderer-version="1">Using Dependent Libraries</a></span> requires that the Averages 1.1 and Ratings 1.1 dynamic libraries be installed on your computer. To install these libraries:</p><ol class="ol"><li class="li"><p>Open this document’s companion-file package.</p></li><li class="li"><p>In Terminal, execute these commands:</p><div class="codesample clear"><table><tr><td scope="row"><pre>[Averages/1.1]% make install<span></span></pre></td></tr><tr><td scope="row"><pre>[Ratings/1.1]% make install<span></span></pre></td></tr></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40002182-SW15" title="Note"></a><p><strong>Note:</strong>&nbsp;To uninstall the libraries, execute these commands:</p><p><div class="codesample clear"><table><tr><td scope="row"><pre>[Averages/1.1]% make uninstall<span></span></pre></td></tr><tr><td scope="row"><pre>[Ratings/1.1]% make uninstall<span></span></pre></td></tr></table></div></p></aside></div></li></ol></section><section><a name="//apple_ref/doc/uid/TP40002182-SW11" title="Using Dependent Libraries"></a><h2 class="jump">Using Dependent Libraries</h2><p>Using dynamic libraries as dependent libraries by linking your image with them provides several benefits, including producing smaller executable files and not having to get the address of the libraries’ exported symbols before using them in your code. However, you still have to make sure a weakly imported symbol exists before using it.</p><p>All you need to do to use a dynamic library as a dependent library is include the library’s headers in your source code and link the library with your program or library. The library’s headers describe the symbols you can use. You should not use any other symbols to access the library’s functionality. Otherwise, you may get unexpected results, or your image may stop working for its users when they update the dependent library in their computers.</p><p><span class="content_text">Listing 1</span> shows the source code of a small program that uses Ratings 1.1, developed in <span class="content_text"><a href="CreatingDynamicLibraries.html#//apple_ref/doc/uid/TP40002073-SW1" data-renderer-version="1">Creating Dynamic Libraries</a></span>.</p><a name="//apple_ref/doc/uid/TP40002182-SW1" title="Listing 1Using Ratings 1.1 as a dependent library"></a><p class="codesample clear"><strong class="caption_number">Listing 1</strong>&nbsp;&nbsp;Using Ratings 1.1 as a dependent library</p><div class="codesample clear"><table><tr><td scope="row"><pre>/* File: StarMeals.c<span></span></pre></td></tr><tr><td scope="row"><pre> * Uses functions in libRatings.A.dylib.<span></span></pre></td></tr><tr><td scope="row"><pre> **************************************/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;string.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Ratings.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_NAMES 100<span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_NAME_LENGTH 30<span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_RATING_LENGTH 5<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static char* name_list[MAX_NAMES];<span></span></pre></td></tr><tr><td scope="row"><pre>static char* rating_list[MAX_NAMES];<span></span></pre></td></tr><tr><td scope="row"><pre>static int names = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void addNameAndRating(char* name, char* rating) {<span></span></pre></td></tr><tr><td scope="row"><pre>    name_list[names] = strdup(name);<span></span></pre></td></tr><tr><td scope="row"><pre>    rating_list[names] = (strlen(rating) > MAX_RATING_LENGTH)? "*****" : strdup(rating);<span></span></pre></td></tr><tr><td scope="row"><pre>    names++;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void test_data(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Spinach", "*");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Cake", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Steak", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Caviar", "*");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Broccoli", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Gagh", "*****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Chicken", "*****");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int main(int argc, char* argv[]) {<span></span></pre></td></tr><tr><td scope="row"><pre>    int test_mode = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (argc == 2) {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (strcmp(argv[1], "test") == 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>            test_mode = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[start_test]\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            test_data();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("Enter meal names and ratings in the form &lt;name> &lt;rating>.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("No spaces are allowed in the name and the rating.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("The rating can be * through *****.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("To finish, enter \"end\" for a meal name.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        while (names &lt; MAX_NAMES) {<span></span></pre></td></tr><tr><td scope="row"><pre>            char name[MAX_NAME_LENGTH];<span></span></pre></td></tr><tr><td scope="row"><pre>            char rating[MAX_RATING_LENGTH + 1];<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("\nName and rating: ");<span></span></pre></td></tr><tr><td scope="row"><pre>            scanf("%s", &amp;name);<span></span></pre></td></tr><tr><td scope="row"><pre>            if (strcmp(name, "end") == 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            scanf("%s", rating);<span></span></pre></td></tr><tr><td scope="row"><pre>            addNameAndRating(name, rating);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (names) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Print data entered and call libRatings.addRating().<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("This is the data you entered:\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        for (int i = 0; i &lt; names; i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("%s (%s)\n", name_list[i], rating_list[i]);<span></span></pre></td></tr><tr><td scope="row"><pre>            addRating(rating_list[i]);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Print statistical information.<span></span></pre></td></tr><tr><td scope="row"><pre class="bold">        printf("\nThe mean rating is %s\n", meanRating()); // 1</pre><pre><span></span></pre></td></tr><tr><td scope="row"><pre class="bold">        if (medianRating) {                                // 2</pre><pre><span></span></pre></td></tr><tr><td scope="row"><pre>            printf("The median rating is %s\n", medianRating());<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre class="bold">        if (frequentRating) {                              // 3</pre><pre><span></span></pre></td></tr><tr><td scope="row"><pre>            printf("The most frequent rating is %s\n", frequentRating());<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        //printf("\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (test_mode) {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("[end_test]\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>This list describes the highlighted lines:</p><ul class="ul"><li class="li"><p>Line 1: The <code>meanRating</code> function is guaranteed to exist in all versions of <code>libRating.A.dylib</code>. Therefore, no existence test is required.</p></li><li class="li"><p>Lines 2 and 3: The functions <code>medianRating</code> and <code>frequentRating</code> are available in Ratings 1.1 but not Ratings 1.0. Since StarMeals is to be backwards compatible with Ratings 1.0, it has to check for the existence of these functions before using them. Otherwise, StarMeals may crash.</p></li></ul><p>To compile the <code>StarMeals.c</code> file, use the command shown in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40002182-SW2" data-renderer-version="1">Listing 2</a></span>.</p><a name="//apple_ref/doc/uid/TP40002182-SW2" title="Listing 2Compiling and linking StarMeals"></a><p class="codesample clear"><strong class="caption_number">Listing 2</strong>&nbsp;&nbsp;Compiling and linking StarMeals</p><div class="codesample clear"><table><tr><td scope="row"><pre>[StarMeals]% make<span></span></pre></td></tr><tr><td scope="row"><pre>clang -std=gnu99 StarMeals.c &lt;user_home>/lib/libRatings.dylib &lt;user_home>/lib/libAverages.dylib -o StarMeals<span></span></pre></td></tr></table></div><p>Notice that the exact location of the library <code>StarMeals</code> directly depends on (<code>libRatings.dylib</code>) is provided at the link line. The pathname <code>&lt;user_home>/lib/libRatings.dylib</code> is actually a symbolic link to <code>&lt;user_home>/lib/libRatings.A.dylib</code>. At link time, the static linker resolves the link and stores the library’s actual filename in the image it generates. With this approach, the dynamic linker always uses the library’s complete name when it looks for an image’s dependent libraries.</p><p><span class="content_text">Listing 3</span> shows the output StarMeals produces when run in test mode:</p><a name="//apple_ref/doc/uid/TP40002182-SW4" title="Listing 3Test output of the StarMeals program"></a><p class="codesample clear"><strong class="caption_number">Listing 3</strong>&nbsp;&nbsp;Test output of the <code>StarMeals</code> program</p><div class="codesample clear"><table><tr><td scope="row"><pre>> ./StarMeals test<span></span></pre></td></tr><tr><td scope="row"><pre>start_test<span></span></pre></td></tr><tr><td scope="row"><pre>This is the data you entered:<span></span></pre></td></tr><tr><td scope="row"><pre>Spinach (*)<span></span></pre></td></tr><tr><td scope="row"><pre>Cake (****)<span></span></pre></td></tr><tr><td scope="row"><pre>Steak (****)<span></span></pre></td></tr><tr><td scope="row"><pre>Caviar (*)<span></span></pre></td></tr><tr><td scope="row"><pre>Broccoli (****)<span></span></pre></td></tr><tr><td scope="row"><pre>Gagh (*****)<span></span></pre></td></tr><tr><td scope="row"><pre>Chicken (*****)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>The mean rating is ***<span></span></pre></td></tr><tr><td scope="row"><pre>The medianRating is ****<span></span></pre></td></tr><tr><td scope="row"><pre>The most frequent rating is ****<span></span></pre></td></tr><tr><td scope="row"><pre>[end_test]<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40002182-SW13" title="Using Runtime-Loaded Libraries"></a><h2 class="jump">Using Runtime-Loaded Libraries</h2><p>An image that uses dynamic libraries as runtime-loaded libraries is smaller and loads faster than the image using the same libraries as dependent libraries. The static linker doesn’t add information about the runtime-loaded libraries to the image. And the dynamic loader doesn’t have to load the library’s dependent libraries  when the image is loaded. However, this flexibility comes at a price. Before an image can use a dynamic library that is not one of its dependent libraries, it must load the library with <code><!--a target="_self" -->dlopen(3) OS X Developer Tools  Manual Page<!--/a--></code> and get the address of each symbol it needs with <code><!--a target="_self" -->dlsym(3) OS X Developer Tools  Manual Page<!--/a--></code>. The image must also call <code><!--a target="_self" -->dlclose(3) OS X Developer Tools  Manual Page<!--/a--></code> when it’s done using the library.</p><p>The StarMeals2 program provides the same functionality that StarMeals provides. But StarMeals2 uses the Ratings 1.1 dynamic library as a runtime loaded library. <span class="content_text"><a href="#//apple_ref/doc/uid/TP40002182-SW5" data-renderer-version="1">Listing 4</a></span> shows the program’s source code.</p><a name="//apple_ref/doc/uid/TP40002182-SW5" title="Listing 4Using Ratings 1.1 as a runtime-loaded library"></a><p class="codesample clear"><strong class="caption_number">Listing 4</strong>&nbsp;&nbsp;Using Ratings 1.1 as a runtime-loaded library</p><div class="codesample clear"><table><tr><td scope="row"><pre>/* File: StarMeals2.c<span></span></pre></td></tr><tr><td scope="row"><pre> * Uses functions in libRatings.A.dylib.<span></span></pre></td></tr><tr><td scope="row"><pre> **************************************/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdlib.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;string.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;dlfcn.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Ratings.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_NAMES 100<span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_NAME_LENGTH 30<span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_RATING_LENGTH 5<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static char *name_list[MAX_NAMES];<span></span></pre></td></tr><tr><td scope="row"><pre>static char *rating_list[MAX_NAMES];<span></span></pre></td></tr><tr><td scope="row"><pre>static int names = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void addNameAndRating(char *name, char *rating) {<span></span></pre></td></tr><tr><td scope="row"><pre>    name_list[names] = strdup(name);<span></span></pre></td></tr><tr><td scope="row"><pre>    rating_list[names] =<span></span></pre></td></tr><tr><td scope="row"><pre>        (strlen(rating) > MAX_RATING_LENGTH)?<span></span></pre></td></tr><tr><td scope="row"><pre>        "*****" : strdup(rating);<span></span></pre></td></tr><tr><td scope="row"><pre>    names++;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void test_data(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Spinach", "*");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Cake", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Steak", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Caviar", "*");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Broccoli", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Gagh", "*****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Chicken", "*****");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int main(int argc, char *argv[]) {<span></span></pre></td></tr><tr><td scope="row"><pre>    int test_mode = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (argc == 2) {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (strcmp(argv[1], "test") == 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>            test_mode = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[start_test]\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            test_data();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("Enter restaurant names and ratings in the form &lt;name> &lt;rating>.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("No spaces are allowed in the name and the rating.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("The rating can be * through *****.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("To finish, enter \"end\" for a restaurant name.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        while (names &lt; MAX_NAMES) {<span></span></pre></td></tr><tr><td scope="row"><pre>            char name[MAX_NAME_LENGTH];<span></span></pre></td></tr><tr><td scope="row"><pre>            char rating[MAX_RATING_LENGTH + 1];<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("\nName and rating: ");<span></span></pre></td></tr><tr><td scope="row"><pre>            scanf("%s", &amp;name);<span></span></pre></td></tr><tr><td scope="row"><pre>            if (strcmp(name, "end") == 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            scanf("%s", rating);<span></span></pre></td></tr><tr><td scope="row"><pre>            addNameAndRating(name, rating);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (names) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Open Ratings library.<span></span></pre></td></tr><tr><td scope="row"><pre>        void* lib_handle = dlopen("libRatings.A.dylib", RTLD_LOCAL|RTLD_LAZY);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!lib_handle) {<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[%s] Unable to load library: %s\n", __FILE__, dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>            exit(EXIT_FAILURE);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Print data entered and call libRatings.A:addRating().<span></span></pre></td></tr><tr><td scope="row"><pre>        void (*addRating)(char*) = dlsym(lib_handle, "addRating");<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!addRating) {       // addRating is guaranteed to exist in libRatings.A.dylib<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[%s] Unable to get symbol: %s\n", __FILE__, dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>            exit(EXIT_FAILURE);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("This is the data you entered:\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        for (int i = 0; i &lt; names; i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("%s (%s)\n", name_list[i], rating_list[i]);<span></span></pre></td></tr><tr><td scope="row"><pre>            addRating(rating_list[i]);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Print statistical information.<span></span></pre></td></tr><tr><td scope="row"><pre>        char *(*meanRating)(void) = dlsym(lib_handle, "meanRating");<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!meanRating) {      // meanRating is guaranteed to exist in libRatings.A.dylib<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[%s] Unable to get symbol: %s\n", __FILE__, dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>            exit(EXIT_FAILURE);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("\nThe mean rating is %s\n", meanRating());<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        char *(*medianRating)(void) = dlsym(lib_handle, "medianRating");<span></span></pre></td></tr><tr><td scope="row"><pre>        if (medianRating) {     // Backwards compatibility with Ratings 1.0<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("The median rating is %s\n", medianRating());<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        char *(*frequentRating)(void) = dlsym(lib_handle, "frequentRating");<span></span></pre></td></tr><tr><td scope="row"><pre>        if (frequentRating) {   // Backwards compatibility with Ratings 1.0<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("The most frequent rating is %s\n", frequentRating());<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Close Ratings library<span></span></pre></td></tr><tr><td scope="row"><pre>        if (dlclose(lib_handle) != 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[%s] Problem closing library: %s", __FILE__, dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (test_mode) {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("[end_test]\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p><span class="content_text"><a href="#//apple_ref/doc/uid/TP40002182-SW6" data-renderer-version="1">Listing 5</a></span> shows to compile the <code>StarMeals2</code> program.</p><a name="//apple_ref/doc/uid/TP40002182-SW6" title="Listing 5Compiling and linking StarMeals2"></a><p class="codesample clear"><strong class="caption_number">Listing 5</strong>&nbsp;&nbsp;Compiling and linking StarMeals2</p><div class="codesample clear"><table><tr><td scope="row"><pre>[StarMeals2]% make<span></span></pre></td></tr><tr><td scope="row"><pre>clang -std=gnu99 StarMeals2.c -I&lt;user_home>/include -o StarMeals2<span></span></pre></td></tr></table></div><p>The static linker doesn’t complain about the unresolved external references in <code>libRatings.A.dylib</code> because it’s not included at the link line. The dynamic linker resolves these references when StarMeals2 uses <code><!--a target="_self" -->dlopen(3) OS X Developer Tools  Manual Page<!--/a--></code> to load <code>libRatings.A.dylib</code>.</p></section><section><a name="//apple_ref/doc/uid/TP40002182-SW14" title="Interposing Functions in Dependent Libraries"></a><h2 class="jump">Interposing Functions in Dependent Libraries</h2><p>Sometimes you need to perform operations before or after a function is called to gather statistical data or to modify its inputs our outputs. For example, you may want to find out how many times a program calls a specific function to determine whether an algorithm should be optimized. However, you may not always have access to the function’s source code to make the modifications. Interposition is a mechanism through which you can define your own version of a function that’s defined in an image’s dependent libraries. In your version, you may or may not call the original function.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40002182-SW17" title="Note"></a><p><strong>Note:</strong>&nbsp;In OS X you can interpose only dependent libraries. Symbols in runtime loaded libraries cannot be interposed.</p><p></p></aside></div><p>To call an interposed function from a custom definition, you use the <code>dlsym(RTLD_NEXT, "&lt;function_name>")</code> call to get the address of the “real” function. For example, <span class="content_text">Listing 6</span> shows how you may write a custom version of a function defined in a dynamic library.</p><a name="//apple_ref/doc/uid/TP40002182-SW7" title="Listing 6Interposing a function"></a><p class="codesample clear"><strong class="caption_number">Listing 6</strong>&nbsp;&nbsp;Interposing a function</p><div class="codesample clear"><table><tr><td scope="row"><pre>char *name(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    static int name_calls = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("[STATS] name() has been called %i times\n", name_calls);<span></span></pre></td></tr><tr><td scope="row"><pre>    char *(*next_name)(void) = dlsym(RTLD_NEXT, "name");<span></span></pre></td></tr><tr><td scope="row"><pre>    return next_name();<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>You may use interposition to adapt an existing dynamic library to your particular needs without changing its API. For example, this document’s companion package includes the implementations of two dynamic libraries called Ratings and RatingsAsGrades. The Ratings library implements a star-based rating system (it can be used to tally restaurant and hotel ratings; for example, *** and *****). The RatingsAsGrades library implements a letter-based grading system, which can be used to tally student grades; for example A and C. Instead of writing a new algorithm to manage letter grades, the RatingsAsGrades library leverages the functionality of the Ratings library. <span class="content_text">Listing 7</span> shows the interface and implementation of the RatingsAsGrades library.</p><a name="//apple_ref/doc/uid/TP40002182-SW8" title="Listing 7RatingsAsGrades Interposing Ratings"></a><p class="codesample clear"><strong class="caption_number">Listing 7</strong>&nbsp;&nbsp;RatingsAsGrades Interposing Ratings</p><div class="codesample clear"><table><tr><td scope="row"><pre>/* File: RatingsInterposed.h<span></span></pre></td></tr><tr><td scope="row"><pre> * Interface to the RatingsAsGrages dynamic library.<span></span></pre></td></tr><tr><td scope="row"><pre> **************************************************/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* Adds 'grade' to the set.<span></span></pre></td></tr><tr><td scope="row"><pre> *      grade: Non-NULL string. Contains zero or<span></span></pre></td></tr><tr><td scope="row"><pre> *             one of these characters:<span></span></pre></td></tr><tr><td scope="row"><pre> *             A, B, C, D, F.<span></span></pre></td></tr><tr><td scope="row"><pre> *             Examples: "", "A", "B".<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>void addRating(char* grade);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* Returns the median grade.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>char *medianRating(void);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* Returns the most frequent grade.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>char *frequentRating(void);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* File: RatingsAsGrades.c<span></span></pre></td></tr><tr><td scope="row"><pre> * Compile with -fvisibility=hidden.<span></span></pre></td></tr><tr><td scope="row"><pre> ***********************************/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#include "RatingsAsGrades.h"<span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;string.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdlib.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;dlfcn.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define EXPORT __attribute__((visibility("default")))<span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_STAR_RATING_LEN 6<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static char *_ratingAsGrade(char *rating) {<span></span></pre></td></tr><tr><td scope="row"><pre>    int rating_length = strlen(rating);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (rating_length > MAX_STAR_RATING_LEN - 1) {<span></span></pre></td></tr><tr><td scope="row"><pre>        rating_length = MAX_STAR_RATING_LEN - 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    char grade;<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (rating_length) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case 5:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = 'A';<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case 4:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = 'B';<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case 3:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = 'C';<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case 2:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = 'D';<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case 1:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = 'F';<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = '\0';<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    char char_grade[2] = { grade, '\0' };<span></span></pre></td></tr><tr><td scope="row"><pre>    return strdup(char_grade);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Interpose libRatings.B.dylib:addRating.<span></span></pre></td></tr><tr><td scope="row"><pre>EXPORT<span></span></pre></td></tr><tr><td scope="row"><pre>void addRating(char* grade) {<span></span></pre></td></tr><tr><td scope="row"><pre>    char rating[MAX_STAR_RATING_LEN] = { '\0' };<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (*grade) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case 'A':<span></span></pre></td></tr><tr><td scope="row"><pre>            strcat(rating, "*");<span></span></pre></td></tr><tr><td scope="row"><pre>        case 'B':<span></span></pre></td></tr><tr><td scope="row"><pre>            strcat(rating, "*");<span></span></pre></td></tr><tr><td scope="row"><pre>        case 'C':<span></span></pre></td></tr><tr><td scope="row"><pre>            strcat(rating, "*");<span></span></pre></td></tr><tr><td scope="row"><pre>        case 'D':<span></span></pre></td></tr><tr><td scope="row"><pre>            strcat(rating, "*");<span></span></pre></td></tr><tr><td scope="row"><pre>        case 'F':<span></span></pre></td></tr><tr><td scope="row"><pre>            strcat(rating, "*");<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            ;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    void (*next_addRating)(char *) =<span></span></pre></td></tr><tr><td scope="row"><pre>dlsym(RTLD_NEXT, "addRating");<span></span></pre></td></tr><tr><td scope="row"><pre>    if (next_addRating) {<span></span></pre></td></tr><tr><td scope="row"><pre>        next_addRating(rating);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("[%s] Fatal problem: %s", __FILE__, dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Interpose libRatings.B.dylib:medianRating.<span></span></pre></td></tr><tr><td scope="row"><pre>EXPORT<span></span></pre></td></tr><tr><td scope="row"><pre>char *medianRating(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    char medianGrade[2] = { '\0' };<span></span></pre></td></tr><tr><td scope="row"><pre>    char *(*next_medianRating)(void) =<span></span></pre></td></tr><tr><td scope="row"><pre>dlsym(RTLD_NEXT, "medianRating");<span></span></pre></td></tr><tr><td scope="row"><pre>    if (next_medianRating) {<span></span></pre></td></tr><tr><td scope="row"><pre>        strcpy(medianGrade,<span></span></pre></td></tr><tr><td scope="row"><pre>_ratingAsGrade(next_medianRating()));<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("[%s] Fatal problem: %s", __FILE__, dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>        exit(EXIT_FAILURE);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return strdup(medianGrade);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Interpose libRatings.B.dylib:frequentRating.<span></span></pre></td></tr><tr><td scope="row"><pre>EXPORT<span></span></pre></td></tr><tr><td scope="row"><pre>char *frequentRating(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    char frequentGrade[2] = { '\0' };<span></span></pre></td></tr><tr><td scope="row"><pre>    char *(*next_frequentRating)(void) =<span></span></pre></td></tr><tr><td scope="row"><pre>        dlsym(RTLD_NEXT, "frequentRating");<span></span></pre></td></tr><tr><td scope="row"><pre>    if (next_frequentRating) {<span></span></pre></td></tr><tr><td scope="row"><pre>        strcpy(frequentGrade,<span></span></pre></td></tr><tr><td scope="row"><pre>            _ratingAsGrade(next_frequentRating()));<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("[%s] Fatal problem: %s", __FILE__, dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>        exit(EXIT_FAILURE);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return strdup(frequentGrade);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Notice how the <code>addRating</code>, <code>medianRating</code>, and <code>frequentRating</code> functions, modify the input and output of the definitions they shadow.</p><p>The companion-files package includes the source code of the <code>Grades</code> program. This program uses the RatingsAsGrades library to tally the grades of students.</p><p>Follow these instructions to build and run the <code>Grades</code> program:</p><ol class="ol"><li class="li"><p>Open this document’s companion-files package.</p></li><li class="li"><p>In Terminal, perform these commands:</p><div class="codesample clear"><table><tr><td scope="row"><pre>[Ratings/1.1]% make install<span></span></pre></td></tr><tr><td scope="row"><pre>[Grades]% make<span></span></pre></td></tr></table></div></li></ol><p><span class="content_text"><a href="#//apple_ref/doc/uid/TP40002182-SW9" data-renderer-version="1">Listing 8</a></span> shows the output of the <code>Grades</code> program when ran in test mode.</p><a name="//apple_ref/doc/uid/TP40002182-SW9" title="Listing 8Test output of the Grades program"></a><p class="codesample clear"><strong class="caption_number">Listing 8</strong>&nbsp;&nbsp;Test output of the <code>Grades</code> program</p><div class="codesample clear"><table><tr><td scope="row"><pre>[Grades]% ./Grades test<span></span></pre></td></tr><tr><td scope="row"><pre>[start_test]<span></span></pre></td></tr><tr><td scope="row"><pre>This is the data you entered:<span></span></pre></td></tr><tr><td scope="row"><pre>Eloise  (F)<span></span></pre></td></tr><tr><td scope="row"><pre>Karla   (B)<span></span></pre></td></tr><tr><td scope="row"><pre>Iva     (B)<span></span></pre></td></tr><tr><td scope="row"><pre>Hilaire (F)<span></span></pre></td></tr><tr><td scope="row"><pre>Jewel   (B)<span></span></pre></td></tr><tr><td scope="row"><pre>Simone  (A)<span></span></pre></td></tr><tr><td scope="row"><pre>Yvette  (A)<span></span></pre></td></tr><tr><td scope="row"><pre>Renee   (A)<span></span></pre></td></tr><tr><td scope="row"><pre>Mimi    (A)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>The median grade is B<span></span></pre></td></tr><tr><td scope="row"><pre>The most frequent grade is A<span></span></pre></td></tr><tr><td scope="row"><pre>[end_test]<span></span></pre></td></tr></table></div></section>
        <div id="pageNavigationLinks_bottom" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='RunpathDependentLibraries.html'>Next</a><a class='previousLink' rel='prev' href='CreatingDynamicLibraries.html'>Previous</a>
        </div><br/>
        <div class="copyright"><br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> Copyright &#x00a9; 2012 Apple Inc. All Rights Reserved. <a href="http://www.apple.com/legal/internet-services/terms/site.html" target="_blank">Terms of Use</a>   |  <a href="http://www.apple.com/privacy/" target="_blank">Privacy Policy</a>  |  Updated: 2012-07-23</p></div></div>

        <div id="pediaWindow">
            <div id="pediaHeader"></div>
            <div id="pediaBody"></div>
        </div>
    </article>

    <div id="blackout">
    <div id="preload"></div>
</div>
<div id="leave_feedback" class="button" role="button" tabindex="0">Feedback</div>
<div id="modal" aria-hidden="true">
    <div id="closebox" tabindex="0" aria-label="Close feedback form" role="button"></div>
    <div id="sending" class="hidden">
        <h2 tabindex="0">Sending feedback&hellip;</h2>
        <div id="sending_img"></div>
    </div>
    <div id="error" class="hidden">
        <h2 tabindex="0">We&rsquo;re sorry, an error has occurred.</h2>
        <p>Please try submitting your feedback later.</p>
        <div id="error_icon"></div>
    </div>
    <div id="success" class="hidden">
        <h2 tabindex="0">Thank you for providing feedback!</h2>
        <p>Your input helps improve our developer documentation.</p>
        <div id="thank_you_icon"></div>
    </div>
    
    <form id="feedback" action="#" method="post">
        <div class="left-leaf">
            <h2 id="helpful_title" data-asterisk="a1" tabindex="0">How helpful is this document?</h2>     
            <sup id="a1" class="asterisk" aria-hidden="true">*</sup>

            <div id="star_group" role="radiogroup" aria-required="true">
                <label> 
                    <input class="radio" type="radio" name="helped" value="1" /> 
                    Very helpful
                </label>
                <label> 
                    <input class="radio" type="radio" name="helped" value="2" /> 
                    Somewhat helpful
                </label>
                <label>
                    <input class="radio" type="radio" name="helped" value="3" /> 
                    Not helpful
                </label>
            </div>
        </div>
        <div class="right-leaf">
            <h2>How can we improve this document?</h2>
            <div id="improve" class="checkboxes">
                <label>
                    <input type="checkbox" name="typo" /> 
                    Fix typos or links
                </label>
                <label>
                    <input type="checkbox" name="infoIncorrect" /> 
                    Fix incorrect information
                </label>
                <label>
                    <input type="checkbox" name="needs_examples" /> 
                    Add or update code samples
                </label>
                <label>
                    <input type="checkbox" name="needs_art" /> 
                    Add or update illustrations
                </label>
                <label>
                    <input type="checkbox" name="missingInfo" /> 
                    Add information about...
                </label>
            </div>
        </div>

        <textarea id="comment" name="problem" cols="70" rows="8" placeholder="Please tell us more about your experience with this document" data-asterisk="a2" required></textarea>
        <sup id="a2" class="asterisk" aria-hidden="true">*</sup>

        <p class="fineprint">
            <em aria-hidden="true"><span>*</span> Required information</em>
        </p> 

        <input id="submit" type="button" value="Send" />

        <section id="legal">
            <p>
                To submit a product bug or enhancement request, please visit the 
                <a href="https://developer.apple.com/bugreporter/" target="_blank">Bug Reporter</a> 
                page.
            </p>
            <p>
                Please read <a href="http://www.apple.com/legal/policies/ideas.html" target="_blank">Apple's Unsolicited Idea Submission Policy</a> 
                before you send us your feedback.
            </p> 
        </section>
    </form>
</div>

    
    <script charset="utf-8" src="../../../../../Resources/1260/JavaScript/lib/prototype.js"></script>
    <script src="../../../../../Resources/1260/JavaScript/library.js"></script>
    <script src="../../../../../Resources/1260/JavaScript/feedback.js"></script>
</body>
</html>
